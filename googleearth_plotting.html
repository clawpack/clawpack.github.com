
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Visualizing GeoClaw results in Google Earth &#8212; Clawpack 5.8.x documentation</title>
    <link rel="stylesheet" href="_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/base.css" type="text/css" />
    <link rel="stylesheet" href="_static/layout.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="_static/clawicon.ico"/>
    <link rel="author" title="About these documents" href="about.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Quick start guide for tsunami modeling" href="quick_tsunami.html" />
    <link rel="prev" title="Plotting routines for GeoClaw" href="plotting_geoclaw.html" /> 
  </head><body>
<div id="main-wrapper" class="sphinx">
<div id="header-wrapper">
  <section id="header">
    <!-- <h1><a href="http://clawpack.org/">Clawpack</a></h1> -->
    <h1><a href="http://clawpack.org/">Clawpack-5</a></h1> 
    <nav>
      <ul>
        <li>
          <a href="contents.html">Docs</a>
        </li>
        <li>
          <a href="installing.html">Install</a>
        </li>
        <li>
          <a class="" href="http://clawpack.org/gallery/index.html">Gallery</a>
        </li>
        <li>
          <a href="about.html">Citation</a>
        </li>
        <li>
          <a class="active" href="http://github.com/clawpack">GitHub</a>
        </li>
        <li>
          <a class="" href="community.html">Community</a>
        </li>
        <li>
          <a class="" href="developers.html">Contribute</a>
        </li>
      </ul>
    </nav>
  </section>
<div class="decoration"></div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="quick_tsunami.html" title="Quick start guide for tsunami modeling"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plotting_geoclaw.html" title="Plotting routines for GeoClaw"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="contents.html">Clawpack 5.8.x documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="geoclaw.html" accesskey="U">GeoClaw Description and Detailed Contents</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="visualizing-geoclaw-results-in-google-earth">
<span id="googleearth-plotting"></span><h1>Visualizing GeoClaw results in Google Earth<a class="headerlink" href="#visualizing-geoclaw-results-in-google-earth" title="Permalink to this headline">¶</a></h1>
<p>The <a class="reference external" href="http://www.google.com/earth">Google Earth</a> browser is a powerful visualization tool for
viewing georeferenced data and images.  The VisClaw visualization suite includes
tools that will produce georeferenced plots and associated KMZ files needed for
animating and browsing your GeoClaw simulation results in Google Earth.  GeoClaw
tsunami simulations are particularly appropriate for the Google Earth
platform in that land topography, ocean bathymetry and wave
disturbances created by tsunamis or other inundation events can all be
viewed simultaneously.</p>
<p>The Google Earth browser is not a fully functional GIS tool, and so
while the simulations may look very realistic, one should not base
critical decisions on conclusions drawn from the Google Earth
visualization alone.  Nevertheless, these realistic visualizations are
useful for setting up simulations and communicating your results.</p>
<div class="section" id="basic-requirements">
<h2>Basic requirements<a class="headerlink" href="#basic-requirements" title="Permalink to this headline">¶</a></h2>
<p>To get started,  you will need to install the Python packages <a class="reference external" href="http://pypi.python.org/pypi/lxml/3.4.0">lxml</a> and
<a class="reference external" href="http://pythonhosted.org/pykml/">pykml</a>.  These libraries can be easily installed through Python
package managers <em>PIP</em> and <em>conda</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="n">lxml</span>   <span class="c1"># May also use PIP</span>
<span class="o">%</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">pykml</span>    <span class="c1"># Not available through conda</span>
</pre></div>
</div>
<p><strong>Test your installation.</strong> You can test your installation by
importing these modules into Python:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import lxml&quot;</span>
<span class="o">%</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import pykml&quot;</span>
</pre></div>
</div>
<div class="section" id="optional-gdal-library">
<h3>Optional GDAL library<a class="headerlink" href="#optional-gdal-library" title="Permalink to this headline">¶</a></h3>
<p>To create a pyramid of images for faster loading in Google Earth, you
will also want to install the Geospatial Data Abstraction Library
(<a class="reference external" href="http://www.gdal.org">GDAL</a>).  The GDAL library (and associated Python bindings)
can be easily installed with <em>conda</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="n">gdal</span>
</pre></div>
</div>
<p>On OSX, the GDAL library can also be installed through MacPorts or Homebrew.</p>
<p>Depending on your installation, you may also need to set the
environment variable <em>GDAL_DATA</em> to point to the directory containing
projection files (e.g. gcs.cvs, epsg.wkt) needed to
georeference and warp your PNG images.  For example, in Anaconda
Python, these support files are installed under the <cite>share/gdal</cite>
directory.  In <em>bash</em>, the <em>GDAL_DATA</em> environment variable can be exported
as</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>export GDAL_DATA=$ANACONDA/share/gdal
</pre></div>
</div>
<p><strong>Note.</strong> It is important to use projection files that are packaged with your particular
installation of <em>GDAL</em>.  Mixing installations and projection files can lead to unexpected
errors.</p>
<p><strong>Test your installation.</strong> You can test your installation of the
<cite>GDAL</cite> library by downloading the script <a class="reference external" href="http://math.boisestate.edu/~calhoun/visclaw/GoogleEarth/gdal_test.py">gdal_test.py</a> and
associated image file <a class="reference external" href="http://math.boisestate.edu/~calhoun/visclaw/GoogleEarth/frame0005fig1.png">frame0005fig1.png</a> (to the same directory) and
running the command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import gdal_test&quot;</span>
</pre></div>
</div>
<p>You should get the output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span>  <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;import gdal_test&quot;</span>
<span class="n">Input</span> <span class="n">file</span> <span class="n">size</span> <span class="ow">is</span> <span class="mi">1440</span><span class="p">,</span> <span class="mi">1440</span>
<span class="n">Creating</span> <span class="n">output</span> <span class="n">file</span> <span class="n">that</span> <span class="ow">is</span> <span class="mi">1440</span><span class="n">P</span> <span class="n">x</span> <span class="mi">1440</span><span class="n">L</span><span class="o">.</span>
<span class="n">Processing</span> <span class="nb">input</span> <span class="n">file</span> <span class="n">frame0005fig1_tmp</span><span class="o">.</span><span class="n">vrt</span><span class="o">.</span>
<span class="n">Using</span> <span class="n">band</span> <span class="mi">4</span> <span class="n">of</span> <span class="n">source</span> <span class="n">image</span> <span class="k">as</span> <span class="n">alpha</span><span class="o">.</span>
<span class="n">Using</span> <span class="n">band</span> <span class="mi">4</span> <span class="n">of</span> <span class="n">destination</span> <span class="n">image</span> <span class="k">as</span> <span class="n">alpha</span><span class="o">.</span>
<span class="n">Generating</span> <span class="n">Base</span> <span class="n">Tiles</span><span class="p">:</span>
<span class="mf">0.</span><span class="o">..</span><span class="mf">10.</span><span class="o">..</span><span class="mf">20.</span><span class="o">..</span><span class="mf">30.</span><span class="o">..</span><span class="mf">40.</span><span class="o">..</span><span class="mf">50.</span><span class="o">..</span><span class="mf">60.</span><span class="o">..</span><span class="mf">70.</span><span class="o">..</span><span class="mf">80.</span><span class="o">..</span><span class="mf">90.</span><span class="o">..</span><span class="mi">100</span> <span class="o">-</span> <span class="n">done</span><span class="o">.</span>
<span class="n">Generating</span> <span class="n">Overview</span> <span class="n">Tiles</span><span class="p">:</span>
<span class="mf">0.</span><span class="o">..</span><span class="mf">10.</span><span class="o">..</span><span class="mf">20.</span><span class="o">..</span><span class="mf">30.</span><span class="o">..</span><span class="mf">40.</span><span class="o">..</span><span class="mf">50.</span><span class="o">..</span><span class="mf">60.</span><span class="o">..</span><span class="mf">70.</span><span class="o">..</span><span class="mf">80.</span><span class="o">..</span><span class="mf">90.</span><span class="o">..</span><span class="mi">100</span> <span class="o">-</span> <span class="n">done</span><span class="o">.</span>
</pre></div>
</div>
<p>This test will create an image pyramid in the directory <cite>frame0005fig1</cite> and an associated
<cite>doc.kml</cite> file which you can open in Google Earth.</p>
<p><strong>NOTE (8/1/16)</strong> The latest release of the Anaconda GDAL library is not fully version compatible with
its dependencies.  If you receive an error that ends with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">Reason</span><span class="p">:</span> <span class="n">Incompatible</span> <span class="n">library</span> <span class="n">version</span><span class="p">:</span> <span class="n">libgdal</span><span class="o">.</span><span class="mf">20.</span><span class="n">dylib</span> <span class="n">requires</span> <span class="n">version</span> <span class="mf">8.0</span><span class="o">.</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">later</span><span class="p">,</span> <span class="n">but</span> <span class="n">liblzma</span><span class="o">.</span><span class="mf">5.</span><span class="n">dylib</span> <span class="n">provides</span> <span class="n">version</span> <span class="mf">6.0</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
<p>you should install a new version of the <cite>xz</cite> library:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">conda</span> <span class="n">install</span> <span class="n">xz</span>
</pre></div>
</div>
<p>This bug can be tracked at <a class="reference external" href="https://github.com/ContinuumIO/anaconda-issues/issues/951">GDAL install bug</a>.</p>
</div>
</div>
<div class="section" id="an-example-the-chile-2010-tsunami-event">
<h2>An example : The Chile 2010 tsunami event<a class="headerlink" href="#an-example-the-chile-2010-tsunami-event" title="Permalink to this headline">¶</a></h2>
<p>The Chile 2010 tsunami is included as an example in the GeoClaw module
of Clawpack.  Once you have run this simulation, you can create the
KMZ file needed for visualizing your data in Google Earth by using the
command:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">make</span> <span class="n">plots</span> <span class="s2">&quot;SETPLOT_FILE=setplot_kml.py&quot;</span>
</pre></div>
</div>
<p>This runs the commands in <em>setplot_kml.py</em>. The resulting archive file
<em>Chile_2010.kmz</em> (created in your plots directory) can be opened in
Google Earth.  An on-line version of the results from this example can
be viewed by opening the file <a class="reference external" href="http://math.boisestate.edu/~calhoun/visclaw/GoogleEarth/kml/Chile_2010.kml">Chile_2010.kml</a> in Google Earth.</p>
<p>Use the time slider to step through the frames of the simulation, or
click on the “animate” button (also in the time slider panel) to animate
the frames.</p>
<div class="figure align-center" id="id2">
<a class="reference internal image-reference" href="_images/GE_Chile.png"><img alt="_images/GE_Chile.png" src="_images/GE_Chile.png" style="width: 577.0px; height: 435.5px;" /></a>
<p class="caption"><span class="caption-text">Simulation of the Chile 2010 tsunami (see geoclaw/examples/tsunami/chile2010).</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<div class="section" id="plotting-attributes-needed-for-google-earth">
<h3>Plotting attributes needed for Google Earth<a class="headerlink" href="#plotting-attributes-needed-for-google-earth" title="Permalink to this headline">¶</a></h3>
<p>The plotting parameters needed to instruct VisClaw to create plots
suitable for visualization in Google Earth are all set as attributes
of instances of the VisClaw classes <em>ClawPlotData</em> and <em>ClawPlotFigure</em>.
We describe each of the relevant attributes and refer to their
usage in the Chile 2010 example file <cite>setplot_kml.py</cite> file.</p>
<p>In what follows, we only refer to instances <cite>plotdata</cite> and <cite>plotfigure</cite>
of the <cite>ClawPlotData</cite> and <cite>ClawPlotFigure</cite> classes.</p>
</div>
<div class="section" id="plotdata-attributes">
<h3>plotdata attributes<a class="headerlink" href="#plotdata-attributes" title="Permalink to this headline">¶</a></h3>
<p>The following <em>plotdata</em> attributes apply to all VisClaw figures to be
visualized in Google Earth.  These attributes are all <strong>optional</strong> and
have reasonable default values.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------</span>
<span class="c1"># plotdata attributes for KML</span>
<span class="c1">#-----------------------------------------</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">kml_name</span> <span class="o">=</span> <span class="s2">&quot;Chile 2010&quot;</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">kml_starttime</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">27</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">34</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Date and time of event in UTC [None]</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">kml_tz_offset</span> <span class="o">=</span> <span class="mi">3</span>    <span class="c1"># Time zone offset (in hours) of event. [None]</span>

<span class="n">plotdata</span><span class="o">.</span><span class="n">kml_index_fname</span> <span class="o">=</span> <span class="s2">&quot;Chile_2010&quot;</span>  <span class="c1"># name for .kmz and .kml files [&quot;_GoogleEarth&quot;]</span>

<span class="n">plotdata</span><span class="o">.</span><span class="n">kml_user_files</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;Santiago.kml&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">])</span>  <span class="c1"># Extra user defined file.</span>

<span class="c1"># Set to a URL where KMZ file will be published.</span>
<span class="c1"># plotdata.kml_publish = None</span>

<span class="c1"># plotdata.kml_map_topo_to_latlong = None  # Use if topo coords. are not lat/long [None]</span>
</pre></div>
</div>
<dl class="attribute">
<dt>
<code class="sig-name descname">kml_name : string</code></dt>
<dd><p>Name used in the Google Earth sidebar to identify the simulation. Default : “GeoClaw”</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_starttime : [Y,M,D,H,M,S]</code></dt>
<dd><p>Start date and time, in UTC,  of the event.  The format is <em>[year,month,day,hour, minute, second]</em>.
By default, local time will be used.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_timezone : integer</code></dt>
<dd><p>Time zone offset, in hours, of the event from UTC.  For example, the offset for Chile is +3 hours,
whereas the offset for Japan is -9 hours.   Default : no time zone offset.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_index_fname : string</code></dt>
<dd><p>The name given to the KMZ file created in the plot directory.  Default : “_GoogleEarth”</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_publish : string</code></dt>
<dd><p>A URL address and path to a remote site hosting a
KMZ file you wish to make available on-line. Default : None</p>
<p>See <a class="reference internal" href="#publishing-your-results">Publishing your results</a> for more details.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_map_topo_to_latlong : function</code></dt>
<dd><p>A function that maps computational coordinates (in meters, for
example) to latitude/longitude coordinates.  This will be called to
position PNG overlays, gauges, patch boundaries, and regions boundaries to the
latitude longitude box specified in <cite>plotfigure.kml_xlimits</cite> and
<cite>plotfigure.kml_ylimits</cite> used by Google Earth.
Default : None.</p>
<p>See <a class="reference internal" href="#mapping-topography-data-to-latitude-longitude-coordinates">Mapping topography data to latitude/longitude coordinates</a>
for details on how to set this function.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_use_figure_limits : boolean</code></dt>
<dd><p>Set to <em>True</em> to indicate that the <cite>plotfigure</cite> limits should be
used as axes limits when creating the PNG file.  If set to <em>False</em>,
then axes limits set by an <cite>axes</cite> member of a <em>plotfigure</em>
(e.g. <em>plotaxes</em>) will be used. Default : True.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_user_files : list</code></dt>
<dd><p>A list of extra user KML files to be archived along with image
files and other plotting artifacts created by the VisClaw
GoogleEarth plotting routines.  These user files can contain, for
example, additional placemarks, polygons, paths or other geographic
features of relevance to the simulation.  These geographic features
will be copied to the KMZ archive and viewable in GoogleEarth,
along with the results of the GeoClaw simulation.</p>
<p>The additional files to be archived are assumed to exist in the
working directory (i.e. the directory containing the plots and
output directories).  For each file to be included, append a list
of the form <cite>[filename, visibility]</cite> where <cite>filename</cite> is the KML
file name (with the <cite>.kml</cite> extension) and <cite>visibility</cite> is either <em>True</em> or
<em>False</em>.  Append this list to the <em>plotdata</em> attribute, as in the
example above.  Default : No user files are included.</p>
</dd></dl>

</div>
<div class="section" id="plotfigure-attributes">
<h3>plotfigure attributes<a class="headerlink" href="#plotfigure-attributes" title="Permalink to this headline">¶</a></h3>
<p>The following attributes apply to an individual figure created for visualization in Google Earth.
The first three attributes are <strong>required</strong>.  The remaining attributes
are optional.</p>
<p>The name “Sea Surface” given to the new instance <cite>plotfigure</cite>, below,
will be used in the Google Earth sidebar to identify this figure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------------------------</span>
<span class="c1"># Figure - Sea Surface</span>
<span class="c1">#----------------------------------------------------------</span>
<span class="n">plotfigure</span> <span class="o">=</span> <span class="n">plotdata</span><span class="o">.</span><span class="n">new_plotfigure</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sea Surface&#39;</span><span class="p">,</span><span class="n">figno</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Required KML attributes for visualization in Google Earth</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">use_for_kml</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_xlimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">120</span><span class="p">,</span><span class="o">-</span><span class="mi">60</span><span class="p">]</span>    <span class="c1"># Longitude</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_ylimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>    <span class="c1"># Latitude</span>

<span class="c1"># Optional attributes</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_use_for_initial_view</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mf">30.0</span><span class="p">,</span><span class="mf">30.0</span><span class="p">]</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_dpi</span> <span class="o">=</span> <span class="mi">12</span>         <span class="c1"># Resolve all three levels</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_tile_images</span> <span class="o">=</span> <span class="kc">False</span>    <span class="c1"># Tile images for faster loading.  Requires GDAL [False]</span>
</pre></div>
</div>
<dl class="attribute">
<dt>
<code class="sig-name descname">use_for_kml : boolean</code></dt>
<dd><p>Indicates to VisClaw that the PNG files created for this figure should be suitable for
visualization in Google Earth. With this set to <cite>True</cite>, all titles, axes labels, colorbars
and tick marks will be suppressed.  Default : <cite>False</cite>.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_xlimits : [longitude_min, longitude_max]</code></dt>
<dd><p>Longitude range used to place PNG images on Google Earth. <em>This setting will override
any limits set as plotaxes attributes</em>.  <strong>Required</strong></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_ylimits : [latitude_min, latitude_max]</code></dt>
<dd><p>Latitude range used to place the PNG images on Google Earth.
<em>This setting will override any limits set as plotaxes attributes</em>.  <strong>Required</strong></p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_use_for_initial_view : boolean</code></dt>
<dd><p>Set to <cite>True</cite> if this figure should be used to determine the initial
camera position in Google Earth.  The initial camera position will
be centered over this figure at an elevation equal to approximately
twice the width of the figure, in meters.  By default, the first
figure encountered with the <cite>use_for_kml</cite> attribute set to <em>True</em>
will be used to set the initial view.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_figsize :  [size_x_inches,size_y_inches]</code></dt>
<dd><p>The figure size, in inches, for the PNG file.  See <a class="reference internal" href="#removing-aliasing-artifacts">Removing
aliasing artifacts</a> for tips on how to set the figure size and dpi
for best results.  Default : 8 x 6 (chosen by Matplotlib).</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_dpi : integer</code></dt>
<dd><p>Number of pixels per inch used in rendering PNG figures.  For best
results, figure size and dpi should be set to respect the numerical
resolution of the the simulation.  See <a class="reference internal" href="#removing-aliasing-artifacts">Removing aliasing
artifacts</a> below for more details on how to improve the quality of
the PNG files created by Matplotlib.  Default : 200.</p>
</dd></dl>

<dl class="attribute">
<dt>
<code class="sig-name descname">kml_tile_images : boolean</code></dt>
<dd><p>Set to <cite>True</cite> if you want to create a pyramid of images at different
resolutions for faster loading in Google Earth.  <em>Image tiling
requires the GDAL library</em>.  See <a class="reference internal" href="#optional-gdal-library">Optional GDAL library</a>, above,
for installation instructions.  Default : False.</p>
</dd></dl>

</div>
<div class="section" id="creating-the-figures">
<h3>Creating the figures<a class="headerlink" href="#creating-the-figures" title="Permalink to this headline">¶</a></h3>
<p>All figures created for Google Earth are rendered as PNG files using
the Matplotlib backend.  So in this sense, the resulting PNG files are
created in a manner that is no different from other VisClaw output
formats.  Furthermore, there are no special <cite>plotaxes</cite> or <em>plotitem</em>
attributes to set for KML figures.  But several attributes will either
be ignored by the KML output or should  be suppressed for best results
in Google Earth.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the figure</span>
<span class="n">plotaxes</span> <span class="o">=</span> <span class="n">plotfigure</span><span class="o">.</span><span class="n">new_plotaxes</span><span class="p">(</span><span class="s1">&#39;kml&#39;</span><span class="p">)</span>

<span class="c1"># Create a pseudo-color plot.  Render the sea level height transparent.</span>
<span class="n">plotitem</span> <span class="o">=</span> <span class="n">plotaxes</span><span class="o">.</span><span class="n">new_plotitem</span><span class="p">(</span><span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;2d_pcolor&#39;</span><span class="p">)</span>
<span class="n">plotitem</span><span class="o">.</span><span class="n">plot_var</span> <span class="o">=</span> <span class="n">geoplot</span><span class="o">.</span><span class="n">surface_or_depth</span>
<span class="n">plotitem</span><span class="o">.</span><span class="n">cmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
<span class="n">plotitem</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">plotitem</span><span class="o">.</span><span class="n">pcolor_cmap</span> <span class="o">=</span> <span class="n">googleearth_transparent</span>

<span class="c1"># Create a colorbar (appears as a Screen Overlay in Google Earth).</span>
<span class="k">def</span> <span class="nf">kml_colorbar</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
  <span class="n">cmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
  <span class="n">cmax</span> <span class="o">=</span> <span class="mf">0.2</span>
  <span class="n">cmap</span> <span class="o">=</span> <span class="n">geoplot</span><span class="o">.</span><span class="n">googleearth_transparent</span>
  <span class="n">geoplot</span><span class="o">.</span><span class="n">kml_build_colorbar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">cmap</span><span class="p">,</span><span class="n">cmin</span><span class="p">,</span><span class="n">cmax</span><span class="p">)</span>

<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_colorbar</span> <span class="o">=</span> <span class="n">kml_colorbar</span>
</pre></div>
</div>
<div class="section" id="plotaxes-attributes">
<h4>plotaxes attributes<a class="headerlink" href="#plotaxes-attributes" title="Permalink to this headline">¶</a></h4>
<p>The plotaxes attributes
<cite>colorbar</cite>, <cite>xlimits</cite>, <cite>ylimits</cite> and <cite>title</cite> will all be ignored by the KML plotting.
For best results, the attribute <cite>scaled</cite> should be set to its default value <cite>False</cite>.  The
only plotaxes attribute that might be useful in some limited contexts is the <cite>afteraxes</cite>
setting, and only if the <cite>afteraxes</cite> function does not add plot features that cause
Matplotlib to alter the space occupied by the figure.   In most cases, the <cite>afteraxes</cite>
commands should not be needed or should not be used.</p>
</div>
<div class="section" id="plotitem-attributes">
<h4>plotitem attributes<a class="headerlink" href="#plotitem-attributes" title="Permalink to this headline">¶</a></h4>
<p>The most useful <cite>plotitem</cite> type will probably be the <cite>2d_pcolor</cite> type, although other
types including the filled contour <cite>contourf</cite> can also be used to good effect.</p>
<p>Colormaps that are designed to work well with Google Earth are</p>
<ul class="simple">
<li><p><cite>geoplot.googleearth_transparent</cite></p></li>
<li><p><cite>geoplot.googleearth_lightblue</cite></p></li>
<li><p><cite>geoplot.googleearth_darkblue</cite></p></li>
</ul>
<p>The transparent
colormap is particularly appealing visually when overlaid onto the Google Earth because
the ocean bathymetry is clearly visible, illustrating the effect that underwater ridges
and so on have on the propagating tsunami. The other two colormaps
are solid colormaps, where the sea level color is set to match that of lighter or darker
regions of the Google Earth ocean bathymetry.</p>
</div>
<div class="section" id="adding-a-colorbar-overlay">
<h4>Adding a colorbar overlay<a class="headerlink" href="#adding-a-colorbar-overlay" title="Permalink to this headline">¶</a></h4>
<p>A colorbar can be associated with each figure in the Google Earth
browser by setting the figure attribute <cite>kml_colorbar</cite> to point to a function
that creates the colorbar:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a colorbar (appears as a Screen Overlay in Google Earth).</span>
<span class="k">def</span> <span class="nf">kml_colorbar</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
  <span class="n">cmin</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.2</span>
  <span class="n">cmax</span> <span class="o">=</span> <span class="mf">0.2</span>
  <span class="n">cmap</span> <span class="o">=</span> <span class="n">geoplot</span><span class="o">.</span><span class="n">googleearth_transparent</span>
  <span class="n">geoplot</span><span class="o">.</span><span class="n">kml_build_colorbar</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">cmap</span><span class="p">,</span><span class="n">cmin</span><span class="p">,</span><span class="n">cmax</span><span class="p">)</span>

<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_colorbar</span> <span class="o">=</span> <span class="n">kml_colorbar</span>
</pre></div>
</div>
<p>The color axis range <cite>[cmin, cmax]</cite> and the colormap <cite>cmap</cite> should be
consistent with those set as plotitem attributes.  By expanding the
figure folder in the Google Earth sidebar, you can use check boxes to
hide or show the colorbar screen overlay.</p>
<p>The input argument <cite>filename</cite> should be passed unaltered to the
routine <cite>geoplot.kml_build_colorbar</cite>.</p>
</div>
</div>
<div class="section" id="gauge-plots">
<h3>Gauge plots<a class="headerlink" href="#gauge-plots" title="Permalink to this headline">¶</a></h3>
<p>There are no particular attributes for gauge plots and so they
can be created in the usual way.  In the Google Earth browser, gauge locations
will be displayed as Placemarks.  Clicking on gauge Placemarks will bring
up the individual gauge plots.  The screenshot below shows the gauge plot
that appears when either the gauge Placemark or the gauge label in the sidebar is
clicked.</p>
<div class="figure align-center" id="id3">
<a class="reference internal image-reference" href="_images/GE_screenshot.png"><img alt="_images/GE_screenshot.png" src="_images/GE_screenshot.png" style="width: 576.0px; height: 323.8px;" /></a>
<p class="caption"><span class="caption-text">Screenshot illustrating gauge plots.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
<p>If the computational coordinates are not in latitude/longitude coordinates, then you must
set the <cite>plotdata</cite> attribute <cite>map_topo_to_latlong</cite> to specify a mapping between the computational
coordinates and latitude longitude box which Google Earth will use to visualize your data.
See <a class="reference internal" href="#plotdata-attributes">plotdata attributes</a>.</p>
</div>
<div class="section" id="additional-plotdata-attributes">
<h3>Additional plotdata attributes<a class="headerlink" href="#additional-plotdata-attributes" title="Permalink to this headline">¶</a></h3>
<p>VisClaw has additional <cite>plotdata</cite> attributes indicating which figures and frames
to plot and which output style to create.  When plotting for Google
Earth, one additional output parameter is necessary.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">print_format</span> <span class="o">=</span> <span class="s1">&#39;png&#39;</span>      <span class="c1"># file format</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">print_framenos</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>    <span class="c1"># list of frames to print</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">print_fignos</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span>      <span class="c1"># list of figures to print</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">html</span> <span class="o">=</span> <span class="kc">False</span>              <span class="c1"># create html files of plots?</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">latex</span> <span class="o">=</span> <span class="kc">False</span>             <span class="c1"># create latex file of plots?</span>
<span class="c1"># ....</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">kml</span> <span class="o">=</span> <span class="kc">True</span>        <span class="c1"># &lt;====== Set to True to create KML/KMZ output</span>

<span class="k">return</span> <span class="n">plotdata</span>   <span class="c1"># end of setplot_kml.py file</span>
</pre></div>
</div>
<dl class="attribute">
<dt>
<code class="sig-name descname">kml : boolean</code></dt>
<dd><p>Set to <cite>True</cite> to indicate that a KML/KMZ file should be created. Default : False.</p>
</dd></dl>

</div>
</div>
<div class="section" id="plotting-tips">
<h2>Plotting tips<a class="headerlink" href="#plotting-tips" title="Permalink to this headline">¶</a></h2>
<p>Below are tips for working with KML/KMZ files, creating zoomed images,
improving the quality of your images and publishing your results.</p>
<div class="section" id="kml-and-kmz-files">
<h3>KML and KMZ files<a class="headerlink" href="#kml-and-kmz-files" title="Permalink to this headline">¶</a></h3>
<p>KML files are very similar to HTML files in that they contan
<cite>&lt;tags&gt;…&lt;/tags&gt;</cite> describing data to be rendered by a suitable
rendering engine.  Whereas as standard web browsers can render content
described by HTML tags, Google Earth renders the geospatial data
described by KML-specific tags.</p>
<p>The <cite>kml</cite> attributes described above will direct VisClaw to create
Google Earth suitable PNG files
for frames and colorbars and a hierarchy of linked KML files,
including a top level <cite>doc.kml</cite> file for the entire simulation, one
top level <cite>doc.kml</cite> file per figure, and additional referenced kml
files per frame.  These KML and image files will not appear
individually in your plots directory, but are archived into a single
KMZ file that you can load in Google Earth.</p>
<p>If you would like to browse the individual images and KML files created
by VisClaw, you can extract them from the KMZ file using an un-archiving
utility. On OSX, for example, you can use <cite>unzip</cite> to extract one or
more individual files from the KMZ file.  Other useful <cite>zip</cite> utilities
include <cite>zip</cite> (used to create the KMZ file initially) and <cite>zipinfo</cite>.</p>
<p>One reason you might wish to view the contents of an individual KMZ
file is to inspect the PNG images generated by Matplotlib and used as
GroundOverlays in the Google Earth browser.  Another reason may be
that you wish to make minor edits the top level doc.kml file to add
additional Google Earth sidebar entries or to change visibility
defaults of individual folders.</p>
<p>The KMZ file can be posted to a website to share your results with others.
See <a class="reference internal" href="#publishing-your-results">Publishing your results</a>, below.</p>
</div>
<div class="section" id="tiling-images-for-faster-loading">
<span id="creating-an-image-pyramid"></span><h3>Tiling images for faster loading<a class="headerlink" href="#tiling-images-for-faster-loading" title="Permalink to this headline">¶</a></h3>
<p>If you create several frames with relatively high dpi, you may find
that the resulting KMZ file is slow to load in Google Earth.  In
extreme cases, large PNG files will not load at all.  You can improve
Google Earth performance by creating an image hierarchy which loads
only a low resolution sampling of the data at low zoom levels and
higher resolution images suitable for close-up views.  In VisClaw,
this image pyramid is created by setting the plotfigure attribute
<cite>kml_tile_images</cite> to <cite>True</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_tile_images</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
<p><strong>Note:</strong> This requires the GDAL library, which can be installed following the
<a class="reference internal" href="#optional-gdal-library">Optional GDAL library</a> instructions, above.</p>
</div>
<div class="section" id="removing-aliasing-artifacts">
<span id="enhancing-the-resolution"></span><h3>Removing aliasing artifacts<a class="headerlink" href="#removing-aliasing-artifacts" title="Permalink to this headline">¶</a></h3>
<p>You may find that the transparent colormap leads to unappealing visual
artifacts.  This can happen when the resolution of the PNG file does
not match the resolution of the data used to create the image.  In the
Chile example, the number of grid cells on the coarsest level is 30 in
each direction. Two additional levels are created by refining first by
a factor of 2 and then by a factor of 6.  But the default settings for
the figure size (<cite>kml_figsize</cite>) is <cite>8x6</cite> inches and dpi (<cite>kml_dpi</cite>) is
200, resulting in an image that is 1600 x 1200.  But because 1600 is
not an even multiple of 30, noticeable vertical stripes appear at the
coarsest level.  A more obvious plaid pattern appears at finer levels,
since neither 1600 or 1200 are evenly divisible by 30*2*6 = 360.</p>
<div class="figure align-center" id="id4">
<a class="reference internal image-reference" href="_images/GE_aliased.png"><img alt="_images/GE_aliased.png" src="_images/GE_aliased.png" style="width: 640.0px; height: 480.0px;" /></a>
<p class="caption"><span class="caption-text">Aliasing effects resulting from default <cite>kml_dpi</cite> and <cite>kml_figsize</cite> settings</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>We can remove these aliasing effects by making the resolution of the
PNG file a multiple of 30*2*6 = 360.  This can be done by setting the
figure size and dpi appropriately:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set dpi and figure size to resolve the 30x30 coarse grid, and two levels of refinement with</span>
<span class="c1"># refinement factors of 2 and 6.</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_dpi</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
<p>The resulting PNG file has a resolution of only 360x360, but in fact, is free of
the vertical and horizontal stripes that appeared in the much higher resolution image
created from the default settings.</p>
<div class="figure align-center" id="id5">
<a class="reference internal image-reference" href="_images/GE_nonaliased.png"><img alt="_images/GE_nonaliased.png" src="_images/GE_nonaliased.png" style="width: 540.0px; height: 540.0px;" /></a>
<p class="caption"><span class="caption-text">Aliasing effects removed by properly setting <cite>kml_dpi</cite> and <cite>kml_figsize</cite></span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
<p>This baseline dpi=12 is the minimum resolution that will remove
striped artifacts from your images. However, you may find that this
resolution is unacceptable, especially for close-up views of
shorelines and so on. In this case, you can increase the resolution of
the figure by integer factors of the baseline dpi.  In the Chile
example, you might try increasing the dpi to 24 or even 48.  The resulting
PNG file, when rendered in Google Earth, should be much sharper when
zoomed in for coastline views.</p>
<p>In some cases, it might not be possible to fully resolve all levels of
a large multi-level simulation because the resulting image resolution
would exceed the Matplotlib limit of 32768 pixels on a side.  In this case,
you can limit the number of levels that are resolved by a particular
figure and create zoomed in figures to resolve finer levels. See
<a class="reference internal" href="#creating-multiple-figures-at-different-resolutions">Creating multiple figures at different resolutions</a>, below.
Alternatively, you can break the computational domain into several
figures, each covering a portion of the entire domain.</p>
<p>If you set <cite>kml_dpi</cite> to a value less than 10, Matplotlib will revert to
a dpi of 72 and change the figure size accordingly, so that the
total number of pixels in each direction will still be equal to
<cite>kml_figsize*kml_dpi</cite>, subject to round-off error.  While you can
avoid aliasing effects if this happens (assuming the dpi is still
consistent with the resolution of the simulation), you can prevent
Matplotlib from switching to a 72 dpi by simply reducing your figure
size by a factor of 10 and increasing your dpi by a factor of 10.</p>
</div>
<div class="section" id="creating-multiple-figures-at-different-resolutions">
<h3>Creating multiple figures at different resolutions<a class="headerlink" href="#creating-multiple-figures-at-different-resolutions" title="Permalink to this headline">¶</a></h3>
<p>You can create several figures for visualization in Google Earth.
Each figure you create will show up as a separate named folder in the Google
Earth sidebar.  The name will match that given to the VisClaw <em>plotfigure</em>.</p>
<p>For at least one figure, you will probably want to set
the <cite>kml_xlimits</cite> and <cite>kml_ylimits</cite> to match the computational domain.
To get higher resolution zoomed in figures, you will want to restrict
the x- and y-limits to a smaller region.  For best results, these zoom
regions should be consistent with the resolution of your simulation.
In the Chile example, a 30x30 inch figure resolves two degrees per inch.
The x- and y-limits for the zoomed in figure should then span an even
number of degrees in each direction, and have boundaries that align
with even degree marks, i.e. -120, -118, -116, etc.  In <strong>setplot_kml.py</strong>,
the zoomed in region is described as :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#-----------------------------------------------------------</span>
<span class="c1"># Figure for KML files (zoom)</span>
<span class="c1">#----------------------------------------------------------</span>
<span class="n">plotfigure</span> <span class="o">=</span> <span class="n">plotdata</span><span class="o">.</span><span class="n">new_plotfigure</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Sea Surface (zoom)&#39;</span><span class="p">,</span><span class="n">figno</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>

<span class="n">plotfigure</span><span class="o">.</span><span class="n">use_for_kml</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_use_for_initial_view</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Use large plot for view</span>

<span class="c1"># Zoomed figure created for Chile example.</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_xlimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">84</span><span class="p">,</span><span class="o">-</span><span class="mi">74</span><span class="p">]</span>    <span class="c1"># 10 degrees</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_ylimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">18</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>     <span class="c1"># 14 degrees</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_figsize</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">14</span><span class="p">]</span>  <span class="c1"># inches. (1 inch per degree)</span>

<span class="c1"># Resolution</span>
<span class="n">rcl</span> <span class="o">=</span> <span class="mi">10</span>    <span class="c1"># Over-resolve the coarsest level</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_dpi</span> <span class="o">=</span> <span class="n">rcl</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="mi">6</span>       <span class="c1"># Resolve all three levels</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_tile_images</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Tile images for faster loading.</span>
</pre></div>
</div>
<p>The resulting figure will have a resolution of 120 dots (i.e. pixels) per inch, compared to the
12 dpi in the larger PNG file covering the whole domain.  The resolution of the zoomed
image is 1200x1680, compared to 360x360 for the larger domain.</p>
<p>This higher resolution figure shows up in the  Google Earth sidebar as “Sea Surface (zoom)”.</p>
<p>See <a class="reference internal" href="#removing-aliasing-artifacts">Removing aliasing artifacts</a> for more details on how to set the zoom levels.</p>
</div>
<div class="section" id="mapping-topography-data-to-latitude-longitude-coordinates">
<span id="publishing-your-results"></span><h3>Mapping topography data to latitude/longitude coordinates<a class="headerlink" href="#mapping-topography-data-to-latitude-longitude-coordinates" title="Permalink to this headline">¶</a></h3>
<p>In many situations, your computational domain may not be conveniently
described in latitude/longitude coordinates. When simulating overland
flooding events, for example, topographic data may more easily be
described in rasterized distance increments (meters, for example).
VisClaw uses data stored in generated data files (<cite>gauges.data</cite>,
<cite>regions.data</cite>, and so on) to position objects on the Google Earth
browser.  The coordinate system for these objects is, however, in
computational coordinates, and so to locate them in the Google Earth
browser, the user must provide VisClaw a function to convert from
computational to latitude/longtitude coordinates.  This is done by
setting the <cite>plotdata</cite> attribute <cite>kml_map_topo_to_latlong</cite> to a
function describing your mapping between the two coordinate systems.</p>
<p>A crucial underlying assumption in setting the mapping function for
use with GoogleEarth is that the boundary of your physical domain is
approximately aligned with spherical (latitude/longitude) coordinate
lines.</p>
<p>The following example illustrates how to set a linear map between the
coordinates in <cite>[0,48000]x[0,17540]</cite> and the latitude/longitude
coordinates that Google Earth will use to visualize the results of
your simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">map_cart_to_latlong</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span><span class="n">yc</span><span class="p">):</span>
    <span class="c1"># Map x-coordinates</span>
    <span class="n">topo_xlim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">48000</span><span class="p">]</span>                     <span class="c1"># x-limits, in meters</span>
    <span class="n">ge_xlim</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">111.96132553</span><span class="p">,</span> <span class="o">-</span><span class="mf">111.36256443</span><span class="p">]</span>  <span class="c1"># longitude limits</span>
    <span class="n">slope_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">ge_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ge_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">topo_xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">topo_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">slope_x</span><span class="o">*</span><span class="p">(</span><span class="n">xc</span><span class="o">-</span><span class="n">topo_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">ge_xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Map y-coordinates</span>
    <span class="n">topo_ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">17500</span><span class="p">]</span>                     <span class="c1"># y-limits, in meters</span>
    <span class="n">ge_ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">43.79453362</span><span class="p">,</span> <span class="mf">43.95123268</span><span class="p">]</span>      <span class="c1"># latitude limits</span>
    <span class="n">slope_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">ge_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ge_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">topo_ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">topo_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">yp</span> <span class="o">=</span> <span class="n">slope_y</span><span class="o">*</span><span class="p">(</span><span class="n">yc</span><span class="o">-</span><span class="n">topo_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">ge_ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">xp</span><span class="p">,</span><span class="n">yp</span>

<span class="c1"># set plotdata attribute.</span>
<span class="n">plotdata</span><span class="o">.</span><span class="n">kml_map_topo_to_latlong</span> <span class="o">=</span> <span class="n">map_cart_to_latlong</span>
</pre></div>
</div>
<p>Figure limits <cite>plotfigure.kml_xlimits</cite> and <cite>plotfigure.kml_ylimits</cite> must still be set to
the latitude/longitude coordinates for your Google Earth figure.  But to indicate that you
do not wish to use these coordinates for creating PNG files, you must set
the <cite>plotfigure.kml_use_figure_limits</cite> attribute to <cite>False</cite>.  This will indicate that when
creating the PNG figure, the axes limits should be set to those specifed in the
<cite>plotaxes</cite> attribute.  For example,</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plotfigure</span> <span class="o">=</span> <span class="n">plotdata</span><span class="o">.</span><span class="n">new_plotfigure</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Teton Dam&#39;</span><span class="p">,</span><span class="n">figno</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">use_for_kml</span> <span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Latlong box used for GoogleEarth</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_xlimits</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">111.96132553</span><span class="p">,</span> <span class="o">-</span><span class="mf">111.36256443</span><span class="p">]</span>  <span class="c1">#  Lat/Long box use by Google Earth</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_ylimits</span> <span class="o">=</span> <span class="p">[</span><span class="mf">43.79453362</span><span class="p">,</span> <span class="mf">43.95123268</span><span class="p">]</span>

<span class="c1"># Use computational coordinates for plotting</span>
<span class="n">plotfigure</span><span class="o">.</span><span class="n">kml_use_figure_limits</span> <span class="o">=</span> <span class="kc">False</span>   <span class="c1"># Use plotaxes limits below</span>

<span class="c1"># ....</span>

<span class="n">plotaxes</span><span class="o">.</span><span class="n">xlimits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">48000</span><span class="p">]</span>   <span class="c1"># Computational axes needed for creating PNG files.</span>
<span class="n">plotaxes</span><span class="o">.</span><span class="n">ylimits</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">17500</span><span class="p">]</span>
</pre></div>
</div>
<p>The mapping function will be used to position PNG Overlays, locate gauge placemarks,
and plot patch and region boundaries on the Google Earth browser.</p>
</div>
<div class="section" id="id1">
<h3>Publishing your results<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>You can easily share your results with collaborators
by providing links to your archive KMZ file in HTML webpages.  Collaborators can
download the KMZ file and open it in a Google Earth browser.</p>
<p>If you find that the KMZ file is too large to make downloading
convenient, you can provide a light-weight KML file that contains a
link to your KMZ file stored on a host server.  Collaborators can then
open this KML file in Google Earth and browse your results remotely.</p>
<p>VisClaw offers an option to automatically create a sample
KML file containing a link to your KMZ file.
To create this KML file, you should set the <cite>plotdata</cite> attribute
<cite>kml_publish</cite> to the url address of your host server where the KMZ
files will be stored.  For example, the Chile file above is stored at:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plotdata</span><span class="o">.</span><span class="n">kml_publish</span> <span class="o">=</span> <span class="s2">&quot;http://math.boisestate.edu/~calhoun/visclaw/GoogleEarth/kmz&quot;</span>
</pre></div>
</div>
<p>VisClaw will detect that this <cite>plotdata</cite> attribute has been set and
automatically create a KML file that refers to the linked file
“Chile_2010.kmz”, stored at the above address.  This KML file (see
<a class="reference external" href="http://math.boisestate.edu/~calhoun/visclaw/GoogleEarth/kml/Chile_2010.kml">Chile_2010.kml</a> for an example) can be easily edited, shared or posted on webpages to allow
collaborators to view your results via links to your remotely stored
KMZ file.</p>
<p>By default,  <cite>plotdata.kml_publish</cite> is set to <cite>None</cite>, in which case, no KML file will be created.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p><a href="http://clawpack.org/">
    <img class="logo" src= "_static/clawlogo.jpg" alt="Logo"/>
</a>
<h2>Version 5.8.x</h2>
</p>
  <h3><a href="contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Visualizing GeoClaw results in Google Earth</a><ul>
<li><a class="reference internal" href="#basic-requirements">Basic requirements</a><ul>
<li><a class="reference internal" href="#optional-gdal-library">Optional GDAL library</a></li>
</ul>
</li>
<li><a class="reference internal" href="#an-example-the-chile-2010-tsunami-event">An example : The Chile 2010 tsunami event</a><ul>
<li><a class="reference internal" href="#plotting-attributes-needed-for-google-earth">Plotting attributes needed for Google Earth</a></li>
<li><a class="reference internal" href="#plotdata-attributes">plotdata attributes</a></li>
<li><a class="reference internal" href="#plotfigure-attributes">plotfigure attributes</a></li>
<li><a class="reference internal" href="#creating-the-figures">Creating the figures</a><ul>
<li><a class="reference internal" href="#plotaxes-attributes">plotaxes attributes</a></li>
<li><a class="reference internal" href="#plotitem-attributes">plotitem attributes</a></li>
<li><a class="reference internal" href="#adding-a-colorbar-overlay">Adding a colorbar overlay</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gauge-plots">Gauge plots</a></li>
<li><a class="reference internal" href="#additional-plotdata-attributes">Additional plotdata attributes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plotting-tips">Plotting tips</a><ul>
<li><a class="reference internal" href="#kml-and-kmz-files">KML and KMZ files</a></li>
<li><a class="reference internal" href="#tiling-images-for-faster-loading">Tiling images for faster loading</a></li>
<li><a class="reference internal" href="#removing-aliasing-artifacts">Removing aliasing artifacts</a></li>
<li><a class="reference internal" href="#creating-multiple-figures-at-different-resolutions">Creating multiple figures at different resolutions</a></li>
<li><a class="reference internal" href="#mapping-topography-data-to-latitude-longitude-coordinates">Mapping topography data to latitude/longitude coordinates</a></li>
<li><a class="reference internal" href="#id1">Publishing your results</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="contents.html">Documentation overview</a><ul>
  <li><a href="geoclaw.html">GeoClaw Description and Detailed Contents</a><ul>
      <li>Previous: <a href="plotting_geoclaw.html" title="previous chapter">Plotting routines for GeoClaw</a></li>
      <li>Next: <a href="quick_tsunami.html" title="next chapter">Quick start guide for tsunami modeling</a></li>
  </ul></li>
  </ul></li>
</ul>
<div class="widget navlinks">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/googleearth_plotting.rst.txt"
            rel="nofollow"
            target="_blank">Source .rst</a></li>
    <li><a href="https://github.com/clawpack/doc/blob/dev/doc/googleearth_plotting.rst"
            rel="nofollow"
            target="_blank">Source on GitHub</a></li>
     <li><a href="https://github.com/clawpack/doc/commits/dev/doc/googleearth_plotting.rst"
             rel="nofollow"
             target="_blank">History</a></li>
    <li><a href="https://github.com/clawpack/doc/edit/dev/doc/googleearth_plotting.rst"
            rel="nofollow"
            target="_blank">Suggest Edits</a></li>
     <li><a href="https://github.com/clawpack/doc/issues/new/choose"
             rel="nofollow"
             target="_blank">Raise an Issue</a></li>
  </ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h4>Latest Version</h4>
<ul>
  <li><a href="./dev/googleearth_plotting.html">dev</a></li>
  <li><a href="googleearth_plotting.html">v5.8.x</a></li>
</ul>
<h4>Older Versions</h4>
<ul>
  <li><a href="./v5.1.x/index.html">v5.1.x</a></li>
  <li><a href="./v5.2.x/index.html">v5.2.x</a></li>
  <li><a href="./v5.3.x/googleearth_plotting.html">v5.3.x</a></li>
  <li><a href="./v5.4.x/googleearth_plotting.html">v5.4.x</a></li>
  <li><a href="./v5.5.x/googleearth_plotting.html">v5.5.x</a></li>
  <li><a href="./v5.6.x/googleearth_plotting.html">v5.6.x</a></li>
  <li><a href="./v5.7.x/googleearth_plotting.html">v5.7.x</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright CC-BY 2020, The Clawpack Development Team.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44811544-1', 'auto');
  ga('send', 'pageview');

  </script>
  
  </body>
</html>