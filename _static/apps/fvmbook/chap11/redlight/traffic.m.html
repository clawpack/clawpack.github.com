<!-- **** DO NOT EDIT THIS FILE *** 
         This file was generated automatically from file
              traffic.m
         using $CLAW/clawutil/src/python/clawutil/clawcode2html.py         -->

<html>
<title> traffic.m.html </title>


          <head>
           <link rel="icon" href="http://clawpack.github.io//clawicon.ico" />
          </head> 
           <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000FF" 
                 VLINK="#5500DD" ALINK="#FF0000">
           <font FACE="HELVETICA,ARIAL">
           
<!-- Created from the file /Users/rjl/git/clawpack/apps/fvmbook/chap11/redlight/traffic.m -->
<!-- Date: Wed Jan  4 2017 at 21:03:39 -->

<table bgcolor="#FFEE99"> <tr> <td>
&nbsp;<font size=6> traffic.m.html </font> </td>

            <td><a href="http://clawpack.github.io/doc/index.html"><img
            src="http://clawpack.github.io//clawlogo.jpg"
            width=100 alt="CLAWPACK"></a>&nbsp;&nbsp; </td> </tr> <tr> <td>
&nbsp;Source file: &nbsp;&nbsp;<a href="traffic.m">traffic.m </a>
</td></tr><tr><td>
&nbsp;Directory:  &nbsp; /Users/rjl/git/clawpack/apps/fvmbook/chap11/redlight 
</td></tr><tr><td>
&nbsp;Converted:  &nbsp; Wed Jan  4 2017 at 21:03:39 
&nbsp; using <a href="http://clawpack.github.io//doc/application_documentation.html#clawcode2html">clawcode2html</a>
</td></tr><tr><td>
<font color="#BB3300"> &nbsp;This documentation file will 
not reflect any later changes in the source file. </font>
</td></tr></table></font>
<p>
<pre> 

<font color="blue">% Traffic flow examples.  Car velocity depends on density seen by driver.</font>
<font color="blue">% This looks best if you make the matlab plot window tall and skinny.</font>
<font color="blue">% R.J. LeVeque,  January, 1998</font>


<font color="blue">% Choose an example and un-comment:</font>

<font color="blue">% Example 1</font>
<font color="blue">% traffic hitting wall and shock wave:</font>

   <font color="blue">% wall = 10;</font>
   <font color="blue">% xlim = [-5 11];</font>
   <font color="blue">% tlim = [-16 2];</font>
   <font color="blue">% carpos = -25:1:5;</font>
   <font color="blue">% umax = 1.5;</font>
   <font color="blue">% nsteps = 40</font>

<font color="blue">% Example 2</font>
<font color="blue">% rarefaction wave when the light turns green:</font>

   wall = 100;
   xlim = [-10 10];
   tlim = [-10 2];
   carpos = -20:.4:0;
   umax = 1.0;
   nsteps = 20


<font color="blue">% Example 3</font>
<font color="blue">% local congestion giving a shock followed by rarefaction:</font>
<font color="blue">% (also try this data with velocity = 1 below to see linear advection)</font>

   <font color="blue">% wall = 100;</font>
       <font color="blue">%carpos = [-40:2:1 1.5:.5:2.5 3:2:12];</font>
       <font color="blue">%carpos = [-50:2:-1 -.5:.5:2.5 3:2:32];</font>
   <font color="blue">% carpos = [-47:4:-3 -2.5:.5:2.5 3:4:43];</font>
   <font color="blue">% xlim = [-20 40];</font>
   <font color="blue">% tlim = [-20 2];</font>
   <font color="blue">% umax = 1.5;</font>
   <font color="blue">% nsteps = 40;</font>

clf
ncar = length(carpos);
carlength = .4;
dt = .4;
tmax = nsteps*dt;
substeps = 4;
dts = dt/substeps;
time = 0;
times = 0;
carpost = carpos;

<font color="blue">% data to draw one little car:</font>
xcar0 = [-.2 .2 .2 .05 .05 -.05 -.05 -.2 -.2];
ycar0 = [  0  0 .1 .1  .2   .2   .1   .1   0];


<font color="blue">% plot initial data:</font>

density = carlength ./ (carpos(2:ncar) - carpos(1:(ncar-1))); 
density(ncar) = .5*carlength ./ (wall - carpos(ncar));

hcars = axes('position',[.1 .1 .8 .7]);
for i=1:ncar
     <font color="blue">% draw cars</font>
     xcar = xcar0 + carpos(i);
     ycar = ycar0 + time;
     plot(xcar,ycar)
     hold on
     end

plot([wall  wall ],tlim,'r')
axis([xlim   tlim])
hold off
  hdensity = axes('position',[.1 .85 .8 .1]);
  plot(carpos, density,'ok')
  title(['density at time ', num2str(time)])
  axis([xlim   -.1 1.1])
pause(3)
<font color="blue">%makeframe(1,[400,250])</font>
<font color="blue">%makeframe(2,[400,250])</font>
clf

<font color="blue">%</font>
<font color="blue">% Time-stepping loop:</font>

for n=1:nsteps

  <font color="blue">% take several substeps within each plotting step to give better</font>
  <font color="blue">% accuracy integrating car paths:</font>

  for nsub = 1:substeps
    time = time + dts;
    times = [times; time];
    <font color="blue">%</font>
    <font color="blue">% compute density and velocity of each car:</font>
    <font color="blue">%</font>
    density = carlength ./ (carpos(2:ncar) - carpos(1:(ncar-1))); 
    density(ncar) = .5*carlength ./ (wall - carpos(ncar));
    <font color="blue">%</font>
    <font color="blue">% nonlinear equation if velocity depends on density:</font>
    <font color="blue">%</font>
    velocity = umax * (1 - density);
    velocity = max(velocity, 0);
    <font color="blue">%</font>
    <font color="blue">% linear advection for constant velocity:</font>
    <font color="blue">% velocity = 1;</font>
    <font color="blue">%</font>
    <font color="blue">% move each car based on velocity (forward Euler):</font>

    carpos = carpos + dts*velocity;
    carpost = [carpost; carpos];  <font color="blue">% array of locations to plot path</font>
    end

  <font color="blue">% plot data at time t:</font>
  clf
  hcars = axes('position',[.1 .1 .8 .7]);
  for i=1:ncar
     <font color="blue">% draw cars</font>
     xcar = xcar0 + carpos(i);
     ycar = ycar0 ;
     plot(xcar,ycar)
     hold on
     plot(carpost(:,i), times-time, 'red')
     end
  axis([xlim   tlim])
  plot([wall  wall ],tlim,'r')
  hold off
  hdensity = axes('position',[.1 .85 .8 .1]);
  plot([carpos,wall], [density,density(ncar)],'ok')
  plot(carpos, density,'ok')
  title(['density at time ', num2str(time)])
  axis([xlim   -.1 1.1])
  drawnow
  pause(.2)
  <font color="blue">% Frame = n;</font>
  <font color="blue">% makeframegif</font>
  end;


</pre></html>
