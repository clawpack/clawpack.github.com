<!-- **** DO NOT EDIT THIS FILE *** 
         This file was generated automatically from file
              rp1swfw.f90
         using $CLAW/clawutil/src/python/clawutil/clawcode2html.py         -->

<html>
<title> rp1swfw.f90.html </title>


          <head>
           <link rel="icon" href="http://www.clawpack.org//_static/clawicon_new.ico" />
          </head> 
           <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000FF" 
                 VLINK="#5500DD" ALINK="#FF0000">
           <font FACE="HELVETICA,ARIAL">
           
<!-- Created from the file /Users/rjl/clawpack_src/clawpack_master/apps/tsunami/shelf1d/rp1swfw.f90 -->
<!-- Date: Sat Apr 18 2020 at 20:30:15 -->

<table bgcolor="#FFEE99"> <tr> <td>
&nbsp;<font size=6> rp1swfw.f90.html </font> </td>

            <td><a href="http://www.clawpack.org/index.html"><img
            src="http://www.clawpack.org//_static/clawlogo_border.jpg"
            width=150 alt="CLAWPACK"></a>&nbsp;&nbsp; </td> </tr> <tr> <td>
&nbsp;Source file: &nbsp;&nbsp;<a href="rp1swfw.f90">rp1swfw.f90 </a>
</td></tr><tr><td>
&nbsp;Directory:  &nbsp; /Users/rjl/clawpack_src/clawpack_master/apps/tsunami/shelf1d 
</td></tr><tr><td>
&nbsp;Converted:  &nbsp; Sat Apr 18 2020 at 20:30:15 
&nbsp; using <a href="http://www.clawpack.org//doc/application_documentation.html#clawcode2html">clawcode2html</a>
</td></tr><tr><td>
<font color="#BB3300"> &nbsp;This documentation file will 
not reflect any later changes in the source file. </font>
</td></tr></table></font>
<p>
<pre> 
<font color="blue">! =========================================================</font>
subroutine rp1(maxmx,meqn,mwaves,maux,mbc,mx,ql,qr,auxl,auxr,fwave,s,amdq,apdq)
<font color="blue">! =========================================================</font>

<font color="blue">! Solve Riemann problems for the 1D shallow water equations</font>
<font color="blue">! with topography source terms</font>
<font color="blue">!   (h)_t + (u h)_x = 0</font>
<font color="blue">!   (uh)_t + ( uuh + .5*gh^2 )_x = -ghB_x</font>
<font color="blue">! using Roe's approximate Riemann solver and the f-wave formulation</font>
<font color="blue">! to incorporate source terms</font>

<font color="blue">! fwaves: 2</font>
<font color="blue">! equations: 2</font>

<font color="blue">! Conserved quantities:</font>
<font color="blue">!       1 depth</font>
<font color="blue">!       2 momentum</font>

<font color="blue">! Auxiliary arrays:</font>
<font color="blue">!       1 topography/bathymetry B</font>

<font color="blue">! This function solves the Riemann problem at all interfaces in one call</font>

<font color="blue">! On input, ql contains the state vector at the left edge of each cell</font>
<font color="blue">!           qr contains the state vector at the right edge of each cell</font>
<font color="blue">! On output, fwave contains the fwaves,</font>
<font color="blue">!            s the speeds,</font>
<font color="blue">!            amdq the  left-going flux difference  A^- \Delta q</font>
<font color="blue">!            apdq the right-going flux difference  A^+ \Delta q</font>

<font color="blue">! Note that the i'th Riemann problem has left state qr(:,i-1)</font>
<font color="blue">!                                    and right state ql(:,i)</font>
<font color="blue">! From the basic clawpack routine step1, rp is called with ql = qr = q.</font>


    implicit double precision (a-h,o-z)

    dimension   ql(meqn,           1-mbc:maxmx+mbc)
    dimension   qr(meqn,           1-mbc:maxmx+mbc)
    dimension    s(mwaves,         1-mbc:maxmx+mbc)
    dimension fwave(meqn,  mwaves, 1-mbc:maxmx+mbc)
    dimension amdq(meqn,           1-mbc:maxmx+mbc)
    dimension apdq(meqn,           1-mbc:maxmx+mbc)
    dimension auxl(maux,           1-mbc:maxmx+mbc)
    dimension auxr(maux,           1-mbc:maxmx+mbc)

<font color="blue">!     # Gravity constant set in the setprob.f</font>
    common /cparam/ grav

<font color="blue">!     # Local storage</font>
<font color="blue">!     ---------------</font>
    dimension delta(2)

<font color="blue">!     # Main loop of the Riemann solver.</font>
    do 30 i=2-mbc,mx+mbc
    
    
    <font color="blue">!     # compute  Roe-averaged quantities:</font>
        ubar = (qr(2,i-1)/dsqrt(qr(1,i-1)) + ql(2,i)/dsqrt(ql(1,i)))/ &
        ( dsqrt(qr(1,i-1)) + dsqrt(ql(1,i)) )
        cbar=dsqrt(0.5d0*grav*(qr(1,i-1) + ql(1,i)))
                 
    <font color="blue">!     # jump in topography:</font>

    <font color="blue">!     # delta = flux difference + source</font>
        delta(1) = ql(2,i) - qr(2,i-1)
        df = (ql(2,i)**2/ql(1,i) + 0.5d0*grav*ql(1,i)**2) - &
             (qr(2,i-1)**2/qr(1,i-1) + 0.5d0*grav*qr(1,i-1)**2) 
        dB = auxl(1,i) - auxr(1,i-1)
        delta(2) = df + 0.5d0*grav*(ql(1,i)+qr(1,i-1))*dB

    <font color="blue">!     # Compute coeffs in the evector expansion of delta(1),delta(2)</font>
        a1 = 0.5d0*(-delta(2) + (ubar + cbar) * delta(1))/cbar
        a2 = 0.5d0*( delta(2) - (ubar - cbar) * delta(1))/cbar

    <font color="blue">!     # Finally, compute the waves.</font>
        fwave(1,1,i) = a1
        fwave(2,1,i) = a1*(ubar - cbar)
        s(1,i) = ubar - cbar
                 
        fwave(1,2,i) = a2
        fwave(2,2,i) = a2*(ubar + cbar)
        s(2,i) = ubar + cbar
                 
    30 END DO


<font color="blue">!     # No entropy fix</font>
<font color="blue">!     ----------------------------------------------</font>
<font color="blue">!     # amdq = SUM fwave   over left-going waves</font>
<font color="blue">!     # apdq = SUM fwave   over right-going waves</font>

    do 100 m=1,2
        do 100 i=2-mbc, mx+mbc
            amdq(m,i) = 0.d0
            apdq(m,i) = 0.d0
            do 90 mw=1,mwaves
                if (s(mw,i) < 0.d0) then
                    amdq(m,i) = amdq(m,i) + fwave(m,mw,i)
                else
                    apdq(m,i) = apdq(m,i) + fwave(m,mw,i)
                endif
            90 END DO
    100 END DO

<font color="blue">!    -----------------------------------------------</font>
    return
    end subroutine rp1



</pre></html>
