<?xml version="1.0" encoding="unicode" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode" />
<meta name="generator" content="Docutils 0.16: http://docutils.sourceforge.net/" />
<title>Tsunami arising offshore Maule, Chile, Feb. 27, 2010</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 7952 2016-07-26 18:15:59Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>

<link rel="icon" href="http://www.clawpack.org/_static/clawicon_new.ico" />
</head>
<body BGCOLOR="#FFFFE8" LINK="#7F0000" VLINK="#7F0000">
<font FACE="TREBUCHET MS,HELVETICA,ARIAL">
<a href="http://www.clawpack.org">
<IMG SRC="http://www.clawpack.org/_static/clawlogo_border.jpg" WIDTH="250" HEIGHT="70" 
VSPACE="0" HSPACE="0" ALT="CLAWPACK" BORDER="0" LOOP="0"> </a>
<div class="document" id="tsunami-arising-offshore-maule-chile-feb-27-2010">
<span id="geoclaw-examples-tsunami-chile2010-adjoint"></span>
<h1 class="title">Tsunami arising offshore Maule, Chile, Feb. 27, 2010</h1>

<p>This is a modified version of <cite>$CLAW/geoclaw/examples/tsunami/chile2010</cite>.
See that directory and README for more information about the problem and data.</p>
<div class="section" id="adjoint-flagging">
<h1>Adjoint flagging</h1>
<p>The adjoint method is used to flag cells needing refinement, as described in
the papers:</p>
<ul class="simple">
<li>Adjoint Methods for Guiding Adaptive Mesh Refinement in Tsunami Modeling
by Brisa N. Davis and R. J. LeVeque, Pure Appl. Geophys. 173 (2016), pp.
4055-4074.
<a class="reference external" href="http://faculty.washington.edu/rjl/pubs/adjoint2016">http://faculty.washington.edu/rjl/pubs/adjoint2016</a></li>
<li>Analysis and Performance Evaluation of Adjoint-Guided Adaptive Mesh
Refinement for Linear Hyperbolic PDEs Using Clawpack, by
B. N. Davis and R. J. LeVeque, Transactions on Mathematical Software
(TOMS) 46 (2020), pp. 26:1-26:28.
<a class="reference external" href="http://faculty.washington.edu/rjl/pubs/adjoint2018">http://faculty.washington.edu/rjl/pubs/adjoint2018</a></li>
</ul>
</div>
<div class="section" id="folder-organization">
<h1>Folder Organization</h1>
<ul>
<li><p class="first"><strong>adjoint:</strong></p>
<p>Contains code to solve the adjoint problem.</p>
<p>The output times specified in this directory should to at least as
far out in time as the forward solution is desired, with sufficiently
dense outputs to properly capture the evolving adjoint solution.</p>
</li>
</ul>
</div>
<div class="section" id="running-the-code">
<h1>Running the Code</h1>
<p>Go to the folder <cite>adjoint</cite> and run in a terminal:</p>
<pre class="literal-block">
make topo  # downloads topo data and creates adjoint initial hump
make new   # compile everything
make .plots
</pre>
<p>The code will produce two new folders: _output and _plots.
The first one contains all the output files, while the latter one contains
the plots and interactive visualization apps.</p>
<p>Then return to this directory and</p>
<blockquote>
make topo  # created dtopo file modeling earthquake
make new
make .plots</blockquote>
<p>to run the forward solution and make plots that also show the inner product
of the forward and adjoint solution on levels 1 and 2 (not on level 3 since
there is no need to flag further in this 3-level run).</p>
<p>Alternatively, to run first the adjoint and then the forward problem a
single script can be invoked.</p>
</div>
<div class="section" id="running-variations">
<h1>Running Variations</h1>
<p>In <cite>setrun.py</cite>, the following flags are currently set (in various places):</p>
<pre class="literal-block">
adjointdata.use_adjoint = True

# Flag for refinement using routine flag2refine:
amrdata.flag2refine = True
rundata.amrdata.flag2refine_tol = 0.0005

# time period of interest:
adjointdata.t1 = rundata.clawdata.t0
adjointdata.t2 = rundata.clawdata.tfinal
</pre>
<p>Setting <cite>adjointdata.use_adjoint</cite> to <cite>False</cite> will go back to using standard
flagging based on the magnitude of undivided differences or an estimate of
the one-step error.  Flagging based on Richardson estimate of the 1-step
error does not generally work well in GeoClaw (with or without the adjoint
inner product), so using <cite>flag2refine</cite> is recommended.</p>
<p>The refinement tolerance is set appropriate for the adjoint flagging. Note
that waves are no longer refined after passing the DART gauge.
The location of interest is specified in <cite>adjoint/maketopo.py</cite>, where
the functional used as initial data (at the final time) in the adjoint
problem is set to be a Gaussian hump centered at the DART gauge location.</p>
<p>The time period of interest can be changed to some subset of the full run
time.  Try changing this to see how the AMR adapts to only capture waves
reaching the gauge over a shorter specified time period, e.g. try <cite>t1 =
3*3600.</cite> and <cite>t2 = 4.5*3600.</cite> to capture only the leading wave at the gauge.</p>
</div>
<div class="section" id="version">

<h2>Files (html versions)</h2>
<ul>

<li><a href="Makefile.html">Makefile</a>

<p>


<p>


<p>

<li><a href="setrun.py.html">setrun.py</a>
<li><a href="setplot.py.html">setplot.py</a>
<li><a href="maketopo.py.html">maketopo.py</a>

<p>


<p>

<li><a href="_plots/_PlotIndex.html">_plots</a>

</ul>
<p>
<h2>Version</h2>
<ul class="simple">
<li>New in Version 5.6.0</li>
<li>Updated for v5.8.0</li>
</ul>
</div>
</div>
</body>
</html>
