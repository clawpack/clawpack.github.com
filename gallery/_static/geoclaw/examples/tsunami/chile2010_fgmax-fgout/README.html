<?xml version="1.0" encoding="unicode" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=unicode" />
<meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<title>Chile 2010 test case for fgmax and fgout routines</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 8954 2022-01-20 10:10:25Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>

<link rel="icon" href="http://www.clawpack.org/_static/clawicon_new.ico" />
</head>
<body BGCOLOR="#FFFFE8" LINK="#7F0000" VLINK="#7F0000">
<font FACE="TREBUCHET MS,HELVETICA,ARIAL">
<a href="http://www.clawpack.org">
<IMG SRC="http://www.clawpack.org/_static/clawlogo_border.jpg" WIDTH="250" HEIGHT="70" 
VSPACE="0" HSPACE="0" ALT="CLAWPACK" BORDER="0" LOOP="0"> </a>
<div class="document" id="chile-2010-test-case-for-fgmax-and-fgout-routines">
<span id="geoclaw-examples-tsunami-chile2010-fgmax-fgout"></span>
<h1 class="title">Chile 2010 test case for fgmax and fgout routines</h1>

<p>This example illustrates the use of an fgmax grid and an fgout grid,
which can be used independently of one another.</p>
<p>For details about this test problem, see
<a class="reference external" href="http://www.clawpack.org/gallery/_static/geoclaw/examples/tsunami/chile2010/README.html">$CLAW/geoclaw/examples/tsunami/chile2010</a>.</p>
<div class="section" id="fgmax-grid">
<h1>fgmax grid</h1>
<p>See <a class="reference external" href="https://www.clawpack.org/fgmax.html">https://www.clawpack.org/fgmax.html</a> for general documentation of
fgmax grids.  In this example, an fgmax grid is used to monitor the
maximum amplitude of the wave at each point in the domain and the
arrival times, in order to make a plot displaying these over the
computational domain, a portion of the south Pacific.</p>
<p>The fgmax grid is specified in <cite>setrun.py</cite> and doing <cite>make data</cite>
(or <cite>make .output</cite>) leads to the creation of a file <cite>fgmax_grids.data</cite>
that is read into GeoClaw.</p>
<p>To test:</p>
<pre class="literal-block">
make topo
make .output
make plots             # to make frame plots and _PlotIndex.html
</pre>
<p>Or simply:</p>
<pre class="literal-block">
make all
</pre>
<p>This should produce
<a class="reference external" href="./_plots/amplitude_times.png">_plots/amplitude_times.png</a>,
a color map of maximum amplitudes along with contours of arrival
time.  This is generated by the code in <cite>plot_fgmax.py</cite> and
a link to this plot should show up in <cite>_plots/_PlotIndex.html</cite>
along with the usual time frame plots.</p>
<p><em>Note:</em></p>
<ul>
<li><p class="first">See <a class="reference external" href="http://www.clawpack.org/fgmax.html">http://www.clawpack.org/fgmax.html</a> for more information about
specifying fgmax parameters.</p>
</li>
<li><p class="first">The time <cite>fg.tstart_max</cite> in <cite>setrun.py</cite> is set to 10 seconds so that the
topography in the source region has been finalized following the
earthquake before we start monitoring the maxima.  (Since the topo on the
fixed grid must also be stored for later postprocessing.)</p>
</li>
<li><p class="first">The refinement parameters and regions are set so that the maximum
amplitude we wish to capture always appears on a level 3 grid and
<cite>fg.min_level_check = 3</cite> is set in <cite>setrun.py</cite>.  Other choices of these
parameters may give misleading or bizarre results.  The fgmax capabilities
were designed with the assumption that the region of interest will always
be refined to the maximum level allowed.</p>
</li>
<li><p class="first">The code in <cite>plot_fgmax.py</cite> is used to plot the fgmax results. Also the file
<cite>setplot.py</cite> includes the lines:</p>
<pre class="literal-block">
otherfigure = plotdata.new_otherfigure(name='max amplitude and arrival times',
             fname='amplitude_times.png')

 def makefig(plotdata):
     plot_fgmax.plot_fgmax_grid(plotdata.outdir, plotdata.plotdir)

 otherfigure.makefig = makefig
</pre>
<p>This results in <cite>plot_fgmax.plot_fgmax_grid</cite> being run and
the link to the resulting figure appearing in <cite>_plots/_PlotIndex.html</cite>.</p>
</li>
</ul>
</div>
<div class="section" id="fgout-grid">
<h1>fgout grid</h1>
<p>See <a class="reference external" href="https://www.clawpack.org/fgout.html">https://www.clawpack.org/fgout.html</a> for general documentation of
fgout grids. Here a single fgout grid is specified in <cite>setrun.py</cite>
that covers most of the computational domain at a fixed resolution.
The solution interpolated to this grid is output every 15 minutes,
more frequently than the usual GeoClaw frames, which in this example
are output only every 2 hours.</p>
<p>To test:</p>
<pre class="literal-block">
make all
</pre>
<p>as suggested above also makes <cite>_plots_fgout</cite> with illustrations of
fgout plots and animations.</p>
<p>This does the following, which you can also do directly at the command line:</p>
<pre class="literal-block">
make plots SETPLOT_FILE=setplot_fgout.py PLOTDIR=_plots_fgout
</pre>
<p>This illustrates one approach to plotting fgout grid results: A setplot
function is specified (in this case by <cite>setplot_fgout.py</cite>) that has the
same form as a setplot function for plotting standard GeoClaw/Clawpack
output frames, but in <cite>setplot_fgout.py</cite> we set</p>
<pre class="literal-block">
plotdata.file_prefix = 'fgout0001'  # for fgout grid fgno==1
</pre>
<p>to indicate that instead of the usual output files with names like
<cite>fort.t*</cite> and <cite>fort.q*</cite> (and also <cite>fort.b*</cite> in the case of binary output),
as described at <a class="reference external" href="https://www.clawpack.org/output_styles.html">https://www.clawpack.org/output_styles.html</a>,
the data is in files named <cite>fgout0001.t*</cite>, etc. but with the same format.</p>
<p>This creates the usual sort of <cite>_plots</cite> directory displaying all the
resulting fgout plots.  In this example we have called this directory
<a class="reference external" href="./_plots_fgout/_PlotIndex.html">_plots_fgout</a>
to differentiate it from the directory
<a class="reference external" href="./_plots/_PlotIndex.html">_plots</a>
which contains the usual plots from output times.</p>
<div class="section" id="loading-and-plotting-fgout-results-directly-and-making-an-mp4-animation">
<h2>Loading and plotting fgout results directly, and making an mp4 animation</h2>
<p>Alternatively, since every fgout frame consists of only a single
uniform grid of data, it is much easier to manipulate or plot
directly than general AMR data. The <cite>clawpack.geoclaw.fgout_tools</cite>
module described at <a class="reference external" href="https://www.clawpack.org/fgout_tools_module.html">https://www.clawpack.org/fgout_tools_module.html</a>
provides tools for reading frames and producing
arrays that can then be worked with directly.</p>
<p>An example of how this might be done is provided in <cite>plot_fgout.py</cite>,
where a single frame is plotted.  To test this do:</p>
<pre class="literal-block">
python plot_fgout.py
</pre>
<p>and a single png file will be created.</p>
<p>The sample code in <cite>make_fgout_animation.py</cite> reads in all the frames
of fgout data and produces an animation as stand-alone mp4 and/or
html files.  To run this code, do:</p>
<pre class="literal-block">
python make_fgout_animation.py
</pre>
<p>Note that this is done automatically by <cite>make fgout_plots</cite> (which in turn is
done automatically by <cite>make all</cite>), in which case
the resulting animations <cite>fgout_animation.mp4</cite> and <cite>fgout_animation.html</cite> are
also moved into <cite>_plots_fgout</cite>.</p>
<p>The use of fgout grids provides a way to produce frequent outputs
on a fixed grid resolution, as often desired for making smooth
animations of a portion of the computational domain.</p>
</div>
<div class="section" id="saving-a-sequence-of-fgout-frames-to-a-single-netcdf-file">
<h2>Saving a sequence of fgout frames to a single netCDF file</h2>
<p>The script <cite>make_netcdf.py</cite> illustrates how to combine multiple fgout
frames of data into a single netCDF file using <cite>fgout_tools.write_netcdf</cite>.
This is easily done since all the fgout results are on the same uniform
grid.  You can also select which quantities of interest to store and use
32-bit floats to store them.</p>
<p>The script <cite>make_netcdf.py</cite> also illustrates how to read the arrays back in
from the netCDF file.  Test it using:</p>
<pre class="literal-block">
python make_netcdf.py
</pre>
<p>This example requires the Python module <a class="reference external" href="https://unidata.github.io/netcdf4-python/">netCDF4</a>.</p>
</div>
</div>
</div>
</body>
</html>
<h2>Files (html versions)</h2>
<ul>

<li><a href="Makefile.html">Makefile</a>

<p>


<p>


<p>

<li><a href="make_fgout_animation.py.html">make_fgout_animation.py</a>
<li><a href="setrun.py.html">setrun.py</a>
<li><a href="setplot.py.html">setplot.py</a>
<li><a href="setplot_fgout.py.html">setplot_fgout.py</a>
<li><a href="plot_fgmax.py.html">plot_fgmax.py</a>
<li><a href="make_netcdf.py.html">make_netcdf.py</a>
<li><a href="plot_fgout.py.html">plot_fgout.py</a>
<li><a href="maketopo.py.html">maketopo.py</a>

<p>


<p>

<li><a href="_plots/_PlotIndex.html">_plots</a>

</ul>
<p>

