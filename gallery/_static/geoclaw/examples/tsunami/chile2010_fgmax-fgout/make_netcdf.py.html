<!-- **** DO NOT EDIT THIS FILE *** 
         This file was generated automatically from file
              make_netcdf.py
         using $CLAW/clawutil/src/python/clawutil/clawcode2html.py         -->

<html>
<title> make_netcdf.py.html </title>


          <head>
           <link rel="icon" href="http://www.clawpack.org//_static/clawicon_new.ico" />
          </head> 
           <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000FF" 
                 VLINK="#5500DD" ALINK="#FF0000">
           <font FACE="HELVETICA,ARIAL">
           
<!-- Created from the file /Users/rjl/clawpack_src/clawpack_master/geoclaw/examples/tsunami/chile2010_fgmax-fgout/make_netcdf.py -->
<!-- Date: Mon Feb 19 2024 at 14:27:24 -->

<table bgcolor="#FFEE99"> <tr> <td>
&nbsp;<font size=6> make_netcdf.py.html </font> </td>

            <td><a href="http://www.clawpack.org/index.html"><img
            src="http://www.clawpack.org//_static/clawlogo_border.jpg"
            width=150 alt="CLAWPACK"></a>&nbsp;&nbsp; </td> </tr> <tr> <td>
&nbsp;Source file: &nbsp;&nbsp;<a href="make_netcdf.py">make_netcdf.py </a>
</td></tr><tr><td>
&nbsp;Directory:  &nbsp; /Users/rjl/clawpack_src/clawpack_master/geoclaw/examples/tsunami/chile2010_fgmax-fgout 
</td></tr><tr><td>
&nbsp;Converted:  &nbsp; Mon Feb 19 2024 at 14:27:24 
&nbsp; using <a href="http://www.clawpack.org//doc/application_documentation.html#clawcode2html">clawcode2html</a>
</td></tr><tr><td>
<font color="#BB3300"> &nbsp;This documentation file will 
not reflect any later changes in the source file. </font>
</td></tr></table></font>
<p>
<pre> 

"""
Test script to read in a sequence of fgout frames, and write a netCDF file
containing only eta from each fgout frame, along with the final topography B.

Then print info about it, and read it back in.
With datatype = 'f8' there should be no difference from the original.
With datatype = 'f4' (32-bit floats) the netCDF file is only half as large.

This example should be turned into a notebook with more discussin...
"""

from clawpack.geoclaw import fgout_tools

try:
    import netCDF4
except:
    'You must install netCDF4 in order to write a netCDF file'
    raise

fgno = 1  <font color="blue"># which fgout grid</font>

outdir = '_output'
format = 'binary'  <font color="blue"># format of fgout grid output</font>

fgframenos = range(1,5)  <font color="blue"># frames of fgout solution to write to netCDF file</font>

<font color="blue"># Instantiate object for reading fgout frames:</font>
fgout_grid = fgout_tools.FGoutGrid(fgno, outdir, format) 

fgout_frames = []
for fgframeno in fgframenos:
    fgout = fgout_grid.read_frame(fgframeno)
    fgout_frames.append(fgout)
    
datatype = 'f4'  <font color="blue"># 'f4' or 'f8' </font>

fgout_tools.write_netcdf(fgout_frames,
                        fname_nc='fgout_frames.nc',
                        qois=['eta'],
                        datatype=datatype,
                        include_B0=True,
                        include_Bfinal=False,
                        description='Chile 2010 test problem',
                        verbose=True)
                
<font color="blue"># ================================================</font>
<font color="blue"># Print out info about this file:</font>
fgout_tools.print_netcdf_info('fgout_frames.nc') 

<font color="blue"># ================================================</font>
<font color="blue"># Read back the saved fgout frames as arrays:</font>

x,y,t,qoi_arrays = fgout_tools.read_netcdf_arrays('fgout_frames.nc',
                                                  ['eta','B0'], verbose=True)
                                                  
B0 = qoi_arrays['B0']
eta = qoi_arrays['eta']

<font color="blue"># Compare h in first frame with the original data:</font>
h0_original = fgout_frames[0].h
h0 = eta[0,:,:] - B0

dh0 = abs(h0 - h0_original).max()
print("With datatype='%s', abs(h0 - h0_original).max() = %.3e" % (datatype,dh0))  

    </pre></html>
