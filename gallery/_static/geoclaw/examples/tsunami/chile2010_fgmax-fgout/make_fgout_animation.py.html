<!-- **** DO NOT EDIT THIS FILE *** 
         This file was generated automatically from file
              make_fgout_animation.py
         using $CLAW/clawutil/src/python/clawutil/clawcode2html.py         -->

<html>
<title> make_fgout_animation.py.html </title>


          <head>
           <link rel="icon" href="http://www.clawpack.org//_static/clawicon_new.ico" />
          </head> 
           <BODY TEXT="#000000" BGCOLOR="#FFFFFF" LINK="#0000FF" 
                 VLINK="#5500DD" ALINK="#FF0000">
           <font FACE="HELVETICA,ARIAL">
           
<!-- Created from the file /Users/rjl/clawpack_src/clawpack_master/geoclaw/examples/tsunami/chile2010_fgmax-fgout/make_fgout_animation.py -->
<!-- Date: Mon Feb 19 2024 at 14:27:24 -->

<table bgcolor="#FFEE99"> <tr> <td>
&nbsp;<font size=6> make_fgout_animation.py.html </font> </td>

            <td><a href="http://www.clawpack.org/index.html"><img
            src="http://www.clawpack.org//_static/clawlogo_border.jpg"
            width=150 alt="CLAWPACK"></a>&nbsp;&nbsp; </td> </tr> <tr> <td>
&nbsp;Source file: &nbsp;&nbsp;<a href="make_fgout_animation.py">make_fgout_animation.py </a>
</td></tr><tr><td>
&nbsp;Directory:  &nbsp; /Users/rjl/clawpack_src/clawpack_master/geoclaw/examples/tsunami/chile2010_fgmax-fgout 
</td></tr><tr><td>
&nbsp;Converted:  &nbsp; Mon Feb 19 2024 at 14:27:24 
&nbsp; using <a href="http://www.clawpack.org//doc/application_documentation.html#clawcode2html">clawcode2html</a>
</td></tr><tr><td>
<font color="#BB3300"> &nbsp;This documentation file will 
not reflect any later changes in the source file. </font>
</td></tr></table></font>
<p>
<pre> 
"""
Make an mp4 animation of fgout grid results. 
This is done in a way that makes the animation quickly and with minimum 
storage required, by making one plot and then defining an update function
that only changes the parts of the plot that change in each frame.
The tuple update_artists contains the list of Artists that must be changed
in update.  Modify this as needed.

"""

from pylab import *
import os
from clawpack.visclaw import plottools, geoplot
from clawpack.visclaw import animation_tools
from matplotlib import animation, colors
from datetime import timedelta

from clawpack.geoclaw import fgout_tools
    
fgno = 1  <font color="blue"># which fgout grid</font>

outdir = '_output'
format = 'binary'  <font color="blue"># format of fgout grid output</font>

fgframes = range(1,26)  <font color="blue"># frames of fgout solution to use in animation</font>

figsize = (10,8)

<font color="blue"># Instantiate object for reading fgout frames:</font>
fgout_grid = fgout_tools.FGoutGrid(fgno, outdir, format) 


<font color="blue"># Plot one frame of fgout data and define the Artists that will need to</font>
<font color="blue"># be updated in subsequent frames:</font>

fgout1 = fgout_grid.read_frame(fgframes[0])

plot_extent = fgout1.extent_edges

ylat = fgout1.Y.mean()  <font color="blue"># for aspect ratio of plots</font>

fig,ax = subplots(figsize=figsize)

ax.set_xlim(plot_extent[:2])
ax.set_ylim(plot_extent[2:])

plottools.pcolorcells(fgout1.X,fgout1.Y,fgout1.B, cmap=geoplot.land_colors)
clim(0,100)

eta = ma.masked_where(fgout1.h<0.001, fgout1.eta)

eta_plot = plottools.pcolorcells(fgout1.X,fgout1.Y,eta,
                                 cmap=geoplot.tsunami_colormap)
clim(-0.3,0.3)
cb = colorbar(eta_plot, extend='both', shrink=0.7)
cb.set_label('meters')
title_text = title('Surface at time %s' % timedelta(seconds=fgout1.t))

ax.set_aspect(1./cos(ylat*pi/180.))
ticklabel_format(useOffset=False)
xticks(rotation=20)
ax.set_xlim(plot_extent[:2])
ax.set_ylim(plot_extent[2:])


<font color="blue"># The artists that will be updated for subsequent frames:</font>
update_artists = (eta_plot, title_text)
        
        
def update(fgframeno, *update_artists):
    """
    Update an exisiting plot with solution from fgout frame fgframeno.
    The artists in update_artists must have new data assigned.
    """
    
    fgout = fgout_grid.read_frame(fgframeno)
    print('Updating plot at time %s' % timedelta(seconds=fgout.t))
    
    <font color="blue"># unpack update_artists (must agree with definition above):</font>
    eta_plot, title_text = update_artists
        
    <font color="blue"># reset title to current time:</font>
    title_text.set_text('Surface at time %s' % timedelta(seconds=fgout.t))

    <font color="blue"># reset surface eta to current state:</font>
    eta = ma.masked_where(fgout.h<0.001, fgout.eta)
    eta_plot.set_array(eta.T.flatten())
        
    update_artists = (eta_plot, title_text)
    return update_artists

def plot_fgframe(fgframeno):
    """
    Convenience function for plotting one frame.
    But if you use this function in IPython and then try to make the animation,
    it may get into an infinite loop (not sure why).  Close the figure to abort.
    """
    update(fgframeno, *update_artists)
                

def make_anim():
    print('Making anim...')
    anim = animation.FuncAnimation(fig, update,
                                   frames=fgframes, 
                                   fargs=update_artists,
                                   interval=200, blit=True)
    return anim

if __name__ == '__main__':

    anim = make_anim()
    
    <font color="blue"># Output files:</font>
    name = 'fgout_animation'

    fname_mp4 = name + '.mp4'

    <font color="blue">#fname_html = None</font>
    fname_html = name + '.html'

    if fname_mp4:
        fps = 5
        print('Making mp4...')
        writer = animation.writers['ffmpeg'](fps=fps)
        anim.save(fname_mp4, writer=writer)
        print("Created %s" % fname_mp4)

    if fname_html:
        <font color="blue"># html version:</font>
        animation_tools.make_html(anim, file_name=fname_html, title=name)
    
    
    
    
</pre></html>
