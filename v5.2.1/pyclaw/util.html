
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Pyclaw Utility Module &#8212; Clawpack 5.2.1 documentation</title>
    <link rel="stylesheet" href="../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../_static/layout.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../_static/clawicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Riemann Solver Package" href="rp.html" />
    <link rel="prev" title="PyClaw Geometry" href="geometry.html" /> 
  </head><body>
<div id="main-wrapper" class="sphinx">
<div id="header-wrapper">
  <section id="header">
    <!-- <h1><a href="http://clawpack.org/">Clawpack</a></h1> -->
    <h1><a href="http://clawpack.org/">Clawpack-5</a></h1> 
    <nav>
      <ul>
        <li>
          <!--<a class="" href="http://clawpack.org">Overview</a>-->
          <a href="../index.html">Overview</a>
        </li>
        <li>
          <a href="../contents.html">Docs</a>
        </li>
        <li>
          <a href="../installing.html">Install</a>
        </li>
        <li>
          <a class="" href="http://clawpack.org/gallery/index.html">Gallery</a>
        </li>
        <li>
          <a class="active" href="http://github.com/clawpack">GitHub</a>
        </li>
        <li>
          <a class="" href="../community.html">Community</a>
        </li>
      </ul>
    </nav>
  </section>
<div class="decoration"></div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rp.html" title="Riemann Solver Package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="geometry.html" title="PyClaw Geometry"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../contents.html">Clawpack 5.2.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Pyclaw</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="pyclaw-utility-module">
<span id="pyclaw-util"></span><h1>Pyclaw Utility Module<a class="headerlink" href="#pyclaw-utility-module" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-pyclaw.util">
<span id="id1"></span><h2><a class="reference internal" href="#module-pyclaw.util" title="pyclaw.util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyclaw.util</span></code></a><a class="headerlink" href="#module-pyclaw.util" title="Permalink to this headline">¶</a></h2>
<p>Pyclaw utility methods</p>
<dl class="class">
<dt id="pyclaw.util.FrameCounter">
<em class="property">class </em><code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">FrameCounter</code><a class="headerlink" href="#pyclaw.util.FrameCounter" title="Permalink to this definition">¶</a></dt>
<dd><p>Simple frame counter</p>
<p>Simple frame counter to keep track of current frame number.  This can
also be used to keep multiple runs frames seperated by having multiple
counters at once.</p>
<p>Initializes to 0</p>
<dl class="method">
<dt id="pyclaw.util.FrameCounter.get_counter">
<code class="sig-name descname">get_counter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.FrameCounter.get_counter" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the current frame number</p>
</dd></dl>

<dl class="method">
<dt id="pyclaw.util.FrameCounter.increment">
<code class="sig-name descname">increment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.FrameCounter.increment" title="Permalink to this definition">¶</a></dt>
<dd><p>Increment the counter by one</p>
</dd></dl>

<dl class="method">
<dt id="pyclaw.util.FrameCounter.reset_counter">
<code class="sig-name descname">reset_counter</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.FrameCounter.reset_counter" title="Permalink to this definition">¶</a></dt>
<dd><p>Reset the counter to 0</p>
</dd></dl>

<dl class="method">
<dt id="pyclaw.util.FrameCounter.set_counter">
<code class="sig-name descname">set_counter</code><span class="sig-paren">(</span><em class="sig-param">new_frame_num</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.FrameCounter.set_counter" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the counter to new_frame_num</p>
</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="pyclaw.util.VerifyError">
<em class="property">exception </em><code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">VerifyError</code><a class="headerlink" href="#pyclaw.util.VerifyError" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="pyclaw.util.add_parent_doc">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">add_parent_doc</code><span class="sig-paren">(</span><em class="sig-param">parent</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.add_parent_doc" title="Permalink to this definition">¶</a></dt>
<dd><p>add parent documentation for a class</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.check_diff">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">check_diff</code><span class="sig-paren">(</span><em class="sig-param">expected</em>, <em class="sig-param">test</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.check_diff" title="Permalink to this definition">¶</a></dt>
<dd><p>Checks the difference between expected and test values, return None if ok</p>
<p>This function expects either the keyword argument ‘abstol’ or ‘reltol’.</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.compile_library">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">compile_library</code><span class="sig-paren">(</span><em class="sig-param">source_list</em>, <em class="sig-param">module_name</em>, <em class="sig-param">interface_functions=[]</em>, <em class="sig-param">local_path='./'</em>, <em class="sig-param">library_path='./'</em>, <em class="sig-param">f2py_flags=''</em>, <em class="sig-param">FC=None</em>, <em class="sig-param">FFLAGS=None</em>, <em class="sig-param">recompile=False</em>, <em class="sig-param">clean=False</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.compile_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Compiles and wraps fortran source into a callable module in python.</p>
<p>This function uses f2py to create an interface from python to the fortran
sources in source_list.  The source_list can either be a list of names
of source files in which case compile_library will search for the file in
local_path and then in library_path.  If a path is given, the file will be
checked to see if it exists, if not it will look for the file in the above
resolution order.  If any source file is not found, an IOException is
raised.</p>
<p>The list interface_functions allows the user to specify which fortran
functions are actually available to python.  The interface functions are
assumed to be in the file with their name, i.e. claw1 is located in
‘claw1.f95’ or ‘claw1.f’.</p>
<p>The interface from fortran may be different than the original function
call in fortran so the user should make sure to check the automatically
created doc string for the fortran module for proper use.</p>
<p>Source files will not be recompiled if they have not been changed.</p>
<p>One set of options of note is for enabling OpenMP, it requires the usual
fortran flags but the OpenMP library also must be compiled in, this is
done with the flag -lgomp.  The call to compile_library would then be:</p>
<p>compile_library(src,module_name,f2py_flags=’-lgomp’,FFLAGS=’-fopenmp’)</p>
<p>For complete optimization use:</p>
<p>FFLAGS=’-O3 -fopenmp -funroll-loops -finline-functions -fdefault-real-8’</p>
<dl class="field-list simple">
<dt class="field-odd">Input</dt>
<dd class="field-odd"><ul class="simple">
<li><p><em>source_list</em> - (list of strings) List of source files, if these are
just names of the source files, i.e. ‘bc1.f’ then they will be searched
for in the default source resolution order, if an explicit path is
given, i.e. ‘./bc1.f’, then the function will use that source if it can
find it.</p></li>
<li><p><em>module_name</em> - (string) Name of the resulting module</p></li>
<li><p><em>interface_functions</em> - (list of strings) List of function names to
provide access to, if empty, all functions are accessible to python.
Defaults to [].</p></li>
<li><p><em>local_path</em> - (string) The base path for source resolution, defaults
to ‘./’.</p></li>
<li><p><em>library_path</em> - (string) The library path for source resolution,
defaults to ‘./’.</p></li>
<li><p><em>f2py_flags</em> - (string) f2py flags to be passed</p></li>
<li><p><em>FC</em> - (string) Override the environment variable FC and use it to
compile, note that this does not replace the compiler that f2py uses,
only the object file compilation (functions that do not have
interfaces)</p></li>
<li><p><em>FFLAGS</em> - (string) Override the environment variable FFLAGS and pass
them to the fortran compiler</p></li>
<li><p><em>recompile</em> - (bool) Force recompilation of the library, defaults to
False</p></li>
<li><p><em>clean</em> - (bool) Force a clean build of all source files</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.construct_function_handle">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">construct_function_handle</code><span class="sig-paren">(</span><em class="sig-param">path</em>, <em class="sig-param">function_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.construct_function_handle" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs a function handle from the file at path.</p>
<p>This function will attempt to construct a function handle from the python
file at path.</p>
<dl class="field-list simple">
<dt class="field-odd">Input</dt>
<dd class="field-odd"><ul class="simple">
<li><p><em>path</em> - (string) Path to the file containing the function</p></li>
<li><p><em>function_name</em> - (string) Name of the function defined in the file
that the handle will point to.  Defaults to the same name as the file
without the extension.</p></li>
</ul>
</dd>
<dt class="field-even">Output</dt>
<dd class="field-even"><ul class="simple">
<li><p>(func) Function handle to the constructed function, None if this has
failed.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.convert_fort_double_to_float">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">convert_fort_double_to_float</code><span class="sig-paren">(</span><em class="sig-param">number</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.convert_fort_double_to_float" title="Permalink to this definition">¶</a></dt>
<dd><p>Converts a fortran format double to a float</p>
<p>Converts a fortran format double to a python float.</p>
<p>number: is a string representation of the double.  Number should
be of the form “1.0d0”</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.gen_variants">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">gen_variants</code><span class="sig-paren">(</span><em class="sig-param">application</em>, <em class="sig-param">verifier</em>, <em class="sig-param">kernel_languages=('Fortran'</em>, <em class="sig-param">)</em>, <em class="sig-param">disable_petsc=False</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.gen_variants" title="Permalink to this definition">¶</a></dt>
<dd><p>Generator of runnable variants of a test application given a verifier</p>
<p>Given an application, a script for verifying its output, and a
list of kernel languages to try, generates all possible variants of the
application to try by taking a product of the available kernel_languages and
(petclaw/pyclaw).  For many applications, this will generate 4 variants:
the product of the two main kernel languages (‘Fortran’ and ‘Python’), against
the the two parallel modes (petclaw and pyclaw).</p>
<p>For more information on how the verifier function should be implemented,
see util.test_app for a description, and util.check_diff for an example.</p>
<p>All unrecognized keyword arguments are passed through to the application.</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.read_data_line">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">read_data_line</code><span class="sig-paren">(</span><em class="sig-param">inputfile</em>, <em class="sig-param">num_entries=1</em>, <em class="sig-param">data_type=&lt;class 'float'&gt;</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.read_data_line" title="Permalink to this definition">¶</a></dt>
<dd><p>Read data a single line from an input file</p>
<p>Reads one line from an input file and returns an array of values</p>
<p>inputfile: a file pointer to an open file object
num_entries: number of entries that should be read, defaults to only 1
type: Type of the values to be read in, they all must be the same type</p>
<p>This function will return either a single value or an array of values
depending on if num_entries &gt; 1</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.run_app_from_main">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">run_app_from_main</code><span class="sig-paren">(</span><em class="sig-param">application</em>, <em class="sig-param">setplot=None</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.run_app_from_main" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs an application from pyclaw/examples/, automatically parsing command line keyword
arguments (key=value) as parameters to the application, with positional
arguments being passed to PETSc (if it is enabled).</p>
<p>Perhaps we should take the PETSc approach of having a database of PyClaw
options that can be queried for options on specific objects within the
PyClaw runtime instead of front-loading everything through the application
main…</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.run_serialized">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">run_serialized</code><span class="sig-paren">(</span><em class="sig-param">fun</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.run_serialized" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorates a function to only run serially, even if called in parallel.</p>
<p>In a parallel communicator, the first process will run while the remaining processes
block on a barrier.  In a serial run, the function will be called directly.</p>
<p>This currently assumes the global communicator is PETSc.COMM_WORLD, but is easily
generalized.</p>
</dd></dl>

<dl class="function">
<dt id="pyclaw.util.test_app">
<code class="sig-prename descclassname">pyclaw.util.</code><code class="sig-name descname">test_app</code><span class="sig-paren">(</span><em class="sig-param">application</em>, <em class="sig-param">verifier</em>, <em class="sig-param">kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pyclaw.util.test_app" title="Permalink to this definition">¶</a></dt>
<dd><p>Test the output of a given application against its verifier method.</p>
<p>This function performs the following two function calls:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output</span> <span class="o">=</span> <span class="n">application</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="n">check_values</span> <span class="o">=</span> <span class="n">verifier</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>The verifier method should return None if the output is correct, otherwise
it should return an indexed sequence of three items:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">0</span> <span class="o">-</span> <span class="n">expected</span> <span class="n">value</span>
<span class="mi">1</span> <span class="o">-</span> <span class="n">test</span> <span class="n">value</span>
<span class="mi">2</span> <span class="o">-</span> <span class="n">string</span> <span class="n">describing</span> <span class="n">the</span> <span class="n">tolerance</span> <span class="nb">type</span> <span class="p">(</span><span class="nb">abs</span><span class="o">/</span><span class="n">rel</span><span class="p">)</span> <span class="ow">and</span> <span class="n">value</span><span class="o">.</span>
</pre></div>
</div>
<p>This information is used to present descriptive help if an error is detected.
For an example verifier method, see util.check_diff</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p><a href="http://clawpack.org/">
    <img class="logo" src= "../_static/clawlogo.jpg" alt="Logo"/>
</a>
<h2>Version 5.2.1</h2>
</p>
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Pyclaw Utility Module</a><ul>
<li><a class="reference internal" href="#module-pyclaw.util"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pyclaw.util</span></code></a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../contents.html">Documentation overview</a><ul>
  <li><a href="index.html">Pyclaw</a><ul>
      <li>Previous: <a href="geometry.html" title="previous chapter">PyClaw Geometry</a></li>
      <li>Next: <a href="rp.html" title="next chapter">Riemann Solver Package</a></li>
  </ul></li>
  </ul></li>
</ul>
<div class="widget navlinks">
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/pyclaw/util.rst.txt"
            rel="nofollow"
            target="_blank">Source .rst</a></li>
    <li><a href="https://github.com/clawpack/doc/blob/dev/doc/pyclaw/util.rst"
            rel="nofollow"
            target="_blank">Source on GitHub</a></li>
     <li><a href="https://github.com/clawpack/doc/commits/dev/doc/pyclaw/util.rst"
             rel="nofollow"
             target="_blank">History</a></li>
    <li><a href="https://github.com/clawpack/doc/edit/dev/doc/pyclaw/util.rst"
            rel="nofollow"
            target="_blank">Suggest Edits</a></li>
     <li><a href="https://github.com/clawpack/doc/issues/new/choose"
             rel="nofollow"
             target="_blank">Raise an Issue</a></li>
  </ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h4>Latest Version</h4>
<ul>
  <li><a href="../../dev/pyclaw/util.html">dev</a></li>
  <li><a href="../../v5.7.0/pyclaw/util.html">v5.7.0</a></li>
</ul>
<h4>Older Versions</h4>
<ul>
  <li><a href="../../v5.1.0/pyclaw/util.html">v5.1.0</a></li>
  <li><a href="../../v5.2.0/pyclaw/util.html">v5.2.0</a></li>
  <li><a href="util.html">v5.2.1</a></li>
  <li><a href="../../v5.3.0/pyclaw/util.html">v5.3.0</a></li>
  <li><a href="../../v5.3.1/pyclaw/util.html">v5.3.1</a></li>
  <li><a href="../../v5.4.0/pyclaw/util.html">v5.4.0</a></li>
  <li><a href="../../v5.4.1/pyclaw/util.html">v5.4.1</a></li>
  <li><a href="../../v5.5.0/pyclaw/util.html">v5.5.0</a></li>
  <li><a href="../../v5.6.0/pyclaw/util.html">v5.6.0</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright CC-BY 2020, The Clawpack Development Team.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44811544-1', 'auto');
  ga('send', 'pageview');

  </script>
  
  </body>
</html>