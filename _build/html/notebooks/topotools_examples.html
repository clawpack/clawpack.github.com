<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GeoClaw topotools examples &#8212; Clawpack dev documentation</title>
    
    <link rel="stylesheet" href="../../../_static/flasky.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/base.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/layout.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     'dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="shortcut icon" href="../../../_static/clawicon.ico"/>
    <link rel="author" title="About these documents" href="../../../about.html" />
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head>
  <body role="document">
<div id="main-wrapper" class="sphinx">
<div id="header-wrapper">
  <section id="header">
    <!-- <h1><a href="http://clawpack.org/">Clawpack</a></h1> -->
    <h1><a href="http://clawpack.org/">Clawpack-5</a></h1> 
    <!-- <h1><img src="../../../_static/clawlogo_border.jpg" width=150/></h1>-->
    <nav>
      <ul>
        <li>
          <a href="../../../contents.html">Docs</a>
        </li>
        <li>
          <a href="../../../installing.html">Install</a>
        </li>
        <li>
          <a class="" href="../../../../../../gallery/_build/html/index.html">Gallery</a>
        </li>
        <li>
          <a class="" href="../../../community.html">Community</a>
        </li>
        <li>
          <a class="active" href="http://github.com/clawpack">Source</a>
        </li>
        <li>
          <a class="" href="../../../developers.html">Develop</a>
        </li>
      </ul>
    </nav>
  </section>
<div class="decoration"></div>
</div>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../contents.html">Clawpack dev documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 9ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>
<div class="section" id="GeoClaw-topotools-examples">
<h1>GeoClaw topotools examples<a class="headerlink" href="#GeoClaw-topotools-examples" title="Permalink to this headline">¶</a></h1>
<p>This notebook contains some examples of working with the
<em>clawpack.geoclaw.topotools</em> module. These tools facilitate creating and
manipulating the <em>topo</em> files that are required as GeoClaw input to
specify topography and bathymetry (underwater topography).</p>
<p>See <a class="reference external" href="http://clawpack.github.io/doc/topotools.html">http://clawpack.github.io/doc/topotools.html</a> for general
documentation of these tools and their use in the context of GeoClaw,
and <a class="reference external" href="http://www.clawpack.org">http://www.clawpack.org</a> for more information on the Clawpack suite
of software.</p>
<div class="section" id="Contents">
<h2>Contents<a class="headerlink" href="#Contents" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Fetching a topo file from the web</li>
<li>Reading a topo file</li>
<li>Plotting topography data</li>
<li>Cropping topography</li>
<li>Unstructured topography</li>
</ul>
<div class="section" id="Setup-notebook-and-environment:">
<h3>Setup notebook and environment:<a class="headerlink" href="#Setup-notebook-and-environment:" title="Permalink to this headline">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">pylab</span> inline
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Populating the interactive namespace from numpy and matplotlib
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">clawpack.geoclaw</span> <span class="kn">import</span> <span class="n">topotools</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">CLAW</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;CLAW&#39;</span><span class="p">]</span>
<span class="n">datadir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">CLAW</span><span class="p">,</span><span class="s1">&#39;geoclaw&#39;</span><span class="p">,</span><span class="s1">&#39;scratch&#39;</span><span class="p">)</span> <span class="c1"># directory for some sample data files</span>
</pre></div>
</div>
</div>
<div id="fetch"></div></div>
</div>
<div class="section" id="Fetching-a-topo-file-from-the-web">
<h2>Fetching a topo file from the web<a class="headerlink" href="#Fetching-a-topo-file-from-the-web" title="Permalink to this headline">¶</a></h2>
<p>Many GeoClaw examples are set up to use topography files that have
already been created and archived on the web, e.g. the example found in
<code class="docutils literal"><span class="pre">$CLAW/geoclaw/examples/tsunami/chile2010</span></code> uses a topo file that can
be obtained by these commands (which are also found in the Python script
<code class="docutils literal"><span class="pre">maketopo.py</span></code> found in that directory):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">clawpack.clawutil.data</span> <span class="kn">import</span> <span class="n">get_remote_file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;etopo10min120W60W60S0S.asc&#39;</span>
<span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;http://www.geoclaw.org/topo/etopo/&#39;</span> <span class="o">+</span> <span class="n">filename</span>
<span class="n">get_remote_file</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">datadir</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
File already exists, not downloading
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&#39;/Users/rjl/git/clawpack/geoclaw/scratch/etopo10min120W60W60S0S.asc&#39;
</pre></div>
</div>
</div>
<p>If all you want to do is use this topo file in a GeoClaw run, you do not
need to use any further Python tools.</p>
<div id="read"></div></div>
<div class="section" id="Reading-a-topo-file">
<h2>Reading a topo file<a class="headerlink" href="#Reading-a-topo-file" title="Permalink to this headline">¶</a></h2>
<p>In order to plot or manipulate the topo data, we first read the file we
just downloaded into a <code class="docutils literal"><span class="pre">topotools.Topography</span></code> object. To do so, we
must know how the data is formatted. This file is in the format
<code class="docutils literal"><span class="pre">topo_type==2</span></code> as described at
<a class="reference external" href="http://clawpack.github.io/doc/topo.html">http://clawpack.github.io/doc/topo.html</a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">topo_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datadir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
<span class="n">topo</span> <span class="o">=</span> <span class="n">topotools</span><span class="o">.</span><span class="n">Topography</span><span class="p">()</span>
<span class="n">topo</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">topo_path</span><span class="p">,</span> <span class="n">topo_type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We can now do various things with the data. First let&#8217;s print out some
basic attributes:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="s2">&quot;The extent of the data in longitude and latitude: &quot;</span>
<span class="k">print</span> <span class="n">topo</span><span class="o">.</span><span class="n">extent</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The extent of the data in longitude and latitude:
[-120.0, -59.999999999879996, -60.0, 1.2000356264252332e-10]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="s2">&quot;The shapes of 1-dimensional arrays of longitude x and latitude y values:&quot;</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">shape</span>
<span class="k">print</span> <span class="s2">&quot;The shapes of 2-dimensional arrays X,Y and the topography data Z:&quot;</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The shapes of 1-dimensional arrays of longitude x and latitude y values: (361,) (361,)
The shapes of 2-dimensional arrays X,Y and the topography data Z: (361, 361)
</pre></div></div>
</div>
<p>From the filename you might guess this is 10-arcminute data, we can
check that it is:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="s2">&quot;topo.delta = &quot;</span><span class="p">,</span><span class="n">topo</span><span class="o">.</span><span class="n">delta</span>
<span class="k">print</span> <span class="s2">&quot;10 arcminutes is 1/6 degree = </span><span class="si">%8.6f</span><span class="s2"> degree&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
topo.delta =  (0.166666666667, 0.166666666667)
10 arcminutes is 1/6 degree = 0.166667 degree
</pre></div></div>
</div>
<div id="plot"></div></div>
<div class="section" id="Plotting-topography-data">
<h2>Plotting topography data<a class="headerlink" href="#Plotting-topography-data" title="Permalink to this headline">¶</a></h2>
<p>A simple plot with various defaults used can be obtained simply by:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">topo</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
/Users/rjl/anaconda/envs/jupyter/lib/python2.7/site-packages/matplotlib/axes/_base.py:1057: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
  if aspect == &#39;normal&#39;:
/Users/rjl/anaconda/envs/jupyter/lib/python2.7/site-packages/matplotlib/axes/_base.py:1062: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
  elif aspect in (&#39;equal&#39;, &#39;auto&#39;):
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[8]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1087d0a10&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/_build_html_notebooks_topotools_examples_16_2.png" src="../../../_images/_build_html_notebooks_topotools_examples_16_2.png" />
</div>
</div>
<p>Various arguments can be supplied for more control, see the
documentation.</p>
<p>Of course you can plot the data any way you want using the X, Y, and Z
attributes, e.g.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">contourf</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">X</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">Y</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">Z</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">7000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="o">-</span><span class="mi">4000</span><span class="p">,</span> <span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">colorbar</span><span class="p">()</span>
<span class="c1"># rescale aspect ratio based on mean latitude so distances more correct:</span>
<span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">cos</span><span class="p">(</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.0</span> <span class="o">*</span> <span class="n">topo</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/_build_html_notebooks_topotools_examples_19_0.png" src="../../../_images/_build_html_notebooks_topotools_examples_19_0.png" />
</div>
</div>
<div id="crop"></div></div>
<div class="section" id="Cropping-topography">
<h2>Cropping topography<a class="headerlink" href="#Cropping-topography" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is useful to crop a large topo file to create a smaller one
that contains a sub-region, e.g.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">filter_region</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">)</span>
<span class="n">topo2</span> <span class="o">=</span> <span class="n">topo</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="n">filter_region</span><span class="p">)</span>
<span class="n">topo2</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[10]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>(120, 180)
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">topo2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[11]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x105e27450&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/_build_html_notebooks_topotools_examples_22_1.png" src="../../../_images/_build_html_notebooks_topotools_examples_22_1.png" />
</div>
</div>
<p>The cropped topography can be written out to a new file, which will be
smaller than the original:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">topo2_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">datadir</span><span class="p">,</span><span class="s1">&#39;tip_of_south_america.tt3&#39;</span><span class="p">)</span>
<span class="n">topo2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">topo2_path</span><span class="p">,</span> <span class="n">topo_type</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="k">print</span> <span class="s2">&quot;Size of the new file: </span><span class="si">%s</span><span class="s2"> bytes&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">topo2_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
<span class="k">print</span> <span class="s2">&quot;Size of the original file: </span><span class="si">%s</span><span class="s2"> bytes&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">topo_path</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Size of the new file: 540384 bytes
Size of the original file: 985529 bytes
</pre></div></div>
</div>
<p>To obtain topography for other regions, see the links at
<a class="reference external" href="http://clawpack.github.io/doc/tsunamidata.html">http://clawpack.github.io/doc/tsunamidata.html</a></p>
<div id="unstructured"></div></div>
<div class="section" id="Unstructured-Topography">
<h2>Unstructured Topography<a class="headerlink" href="#Unstructured-Topography" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">topotools</span></code> and <code class="docutils literal"><span class="pre">Topography</span></code> class also have facilities for
handling unstructured topography data. To start we will randomly sample
the data we were working with above to get an unstructured data file.
Here we generate random tuples of longitude-latitude and interpolate the
original data so we can get a field at the random points.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="kn">as</span> <span class="nn">interpolate</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">topo</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">topo</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">topo</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">topo</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Here we need to transpose the Z array so that the coordinate evaluation is correct</span>
<span class="n">bathy</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">RectBivariateSpline</span><span class="p">(</span><span class="n">topo</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">topo</span><span class="o">.</span><span class="n">Z</span><span class="o">.</span><span class="n">transpose</span><span class="p">())</span>

<span class="c1"># strange hack to evaluate the function `bathy` produced by RectBivariateSpline since bathy(x, y) does not work</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bathy</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now lets construct the unstructured topography object based on the
random locations we just generated.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">unstructured_topo</span> <span class="o">=</span> <span class="n">topotools</span><span class="o">.</span><span class="n">Topography</span><span class="p">(</span><span class="n">unstructured</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">unstructured_topo</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">unstructured_topo</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
<span class="n">unstructured_topo</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">z</span>
</pre></div>
</div>
</div>
<p>We can plot the data as is to see what we randomly created so far</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">unstructured_topo</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[16]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x10aa23890&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/_build_html_notebooks_topotools_examples_33_1.png" src="../../../_images/_build_html_notebooks_topotools_examples_33_1.png" />
</div>
</div>
<p>One of the primary things we want to be able to do with unstructured
topography data is to turn it into structured data which GeoClaw can
use. In order to do this, there is a method in the <code class="docutils literal"><span class="pre">Topography</span></code> class
called <code class="docutils literal"><span class="pre">interp_unstructured</span></code> which has a number of options. Here we
will just go with the defaults (please see the documentation for the
full assortment of options). In this case we will provide two things to
the routine. The first is topography to use to fill in possible gaps in
the unstructured topography. This &#8220;fill topography&#8221; can be structured or
unstructured. The second argument we provide is a limit on the
calculated grid spacing. The routine attempts to calculate the minimum
distance between two points and uses this as the basis of the structured
grid. Placing a limit on this insures that the resulting grid is not too
fine. Addtional options for filtering the data in the routine, smoothing
and interpolation strategies are also available.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">unstructured_topo</span><span class="o">.</span><span class="n">interp_unstructured</span><span class="p">(</span><span class="n">topo</span><span class="p">,</span> <span class="n">delta_limit</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now that the topography has been interpolated onto a new grid, we can
check to see if the <code class="docutils literal"><span class="pre">unstructured</span></code> attribute is in fact now set to
<code class="docutils literal"><span class="pre">False</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">unstructured_topo</span><span class="o">.</span><span class="n">unstructured</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[18]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>False
</pre></div>
</div>
</div>
<p>Usually at this point you will want to save out a copy of the
interpolated topography for use with GeoClaw, the usual functions from
before work of course. More interesting is to plot the new topography
which we can again do by using the <code class="docutils literal"><span class="pre">plot</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">unstructured_topo</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area highlight-none"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x10bd3d7d0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/_build_html_notebooks_topotools_examples_39_1.png" src="../../../_images/_build_html_notebooks_topotools_examples_39_1.png" />
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p><a href="http://clawpack.org/">
    <img class="logo" src= "../../../_static/clawlogo.jpg" alt="Logo"/>
</a>
<h2>Version dev</h2>
</p>
  <h3><a href="../../../contents.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">GeoClaw topotools examples</a><ul>
<li><a class="reference internal" href="#Contents">Contents</a><ul>
<li><a class="reference internal" href="#Setup-notebook-and-environment:">Setup notebook and environment:</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Fetching-a-topo-file-from-the-web">Fetching a topo file from the web</a></li>
<li><a class="reference internal" href="#Reading-a-topo-file">Reading a topo file</a></li>
<li><a class="reference internal" href="#Plotting-topography-data">Plotting topography data</a></li>
<li><a class="reference internal" href="#Cropping-topography">Cropping topography</a></li>
<li><a class="reference internal" href="#Unstructured-Topography">Unstructured Topography</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../contents.html">Documentation overview</a><ul>
  </ul></li>
</ul>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../../_sources/_build/html/notebooks/topotools_examples.ipynb.txt"
           rel="nofollow">Show Source</a></li>
    <li><a href="https://github.com/clawpack/doc/blob/master/doc/_build/html/notebooks/topotools_examples.ipynb"
           rel="nofollow">Show on GitHub</a></li>
    <li><a href="https://github.com/clawpack/doc/edit/master/doc/_build/html/notebooks/topotools_examples.ipynb"
           rel="nofollow">Edit on GitHub</a></li>
  </ul>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
    &copy; Copyright CC-BY 2019, The Clawpack Development Team.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44811544-1', 'auto');
  ga('send', 'pageview');

  </script>
  
  </body>
</html>